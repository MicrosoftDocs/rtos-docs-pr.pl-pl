---
title: Rozdział 6 — moduł odporny na błędy usługi Azure RTO FileX
description: Ten rozdział zawiera opis modułu odpornego na błędy usługi Azure RTO FileX, który został zaprojektowany z myślą o utrzymaniu integralności systemu plików, jeśli nośnik utraci energię lub zostanie wysunięty w trakcie operacji zapisu pliku.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 68a24f0345a2c4d3e824270699b00a2daab32f8e
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/22/2021
ms.locfileid: "104822410"
---
# <a name="chapter-6---azure-rtos-filex-fault-tolerant-module"></a><span data-ttu-id="539ca-103">Rozdział 6 — moduł odporny na błędy usługi Azure RTO FileX</span><span class="sxs-lookup"><span data-stu-id="539ca-103">Chapter 6 - Azure RTOS FileX fault tolerant module</span></span>

<span data-ttu-id="539ca-104">Ten rozdział zawiera opis modułu odpornego na błędy usługi Azure RTO FileX, który został zaprojektowany z myślą o utrzymaniu integralności systemu plików, jeśli nośnik utraci energię lub zostanie wysunięty w trakcie operacji zapisu pliku.</span><span class="sxs-lookup"><span data-stu-id="539ca-104">This chapter contains a description of the Azure RTOS FileX Fault Tolerant Module that is designed to maintain file system integrity if the media loses power or is ejected in the middle of a file write operation.</span></span>

## <a name="filex-fault-tolerant-module-overview"></a><span data-ttu-id="539ca-105">Przegląd modułu odpornego na błędy FileX</span><span class="sxs-lookup"><span data-stu-id="539ca-105">FileX Fault Tolerant Module Overview</span></span>

<span data-ttu-id="539ca-106">Gdy aplikacja zapisuje dane do pliku, FileX aktualizuje zarówno klastry danych, jak i informacje o systemie.</span><span class="sxs-lookup"><span data-stu-id="539ca-106">When an application writes data into a file, FileX updates both data clusters and system information.</span></span> <span data-ttu-id="539ca-107">Te aktualizacje należy wykonać jako niepodzielną operację, aby zachować spójność informacji w systemie plików.</span><span class="sxs-lookup"><span data-stu-id="539ca-107">These updates must be completed as an atomic operation to keep information in the file system coherent.</span></span> <span data-ttu-id="539ca-108">Na przykład podczas dołączania danych do pliku FileX musi znaleźć dostępny klaster na nośniku, zaktualizować łańcuch systemu plików FAT, zaktualizować długość wpisu w katalogu i ewentualnie zaktualizować początkowy numer klastra w pozycji katalog.</span><span class="sxs-lookup"><span data-stu-id="539ca-108">For example, when appending data to a file, FileX needs to find an available cluster in the media, update the FAT chain, update the length filed in the directory entry, and possibly update the starting cluster number in the directory entry.</span></span> <span data-ttu-id="539ca-109">Awaria lub wysuwanie nośnika może przerwać sekwencję aktualizacji, co spowoduje pozostawienie systemu plików w stanie niespójnym.</span><span class="sxs-lookup"><span data-stu-id="539ca-109">Either a power failure or media ejection can interrupt the sequence of updates, which will leave the file system in an inconsistent state.</span></span> <span data-ttu-id="539ca-110">Jeśli niespójny stan nie zostanie poprawiony, aktualizowane dane mogą zostać utracone i z powodu uszkodzenia informacji o systemie kolejna operacja systemu plików może uszkodzić inne pliki lub katalogi na nośniku.</span><span class="sxs-lookup"><span data-stu-id="539ca-110">If the inconsistent state is not corrected, the data being updated can be lost, and because of damage to the system information, subsequent file system operation may damage other files or directories on the media.</span></span>

<span data-ttu-id="539ca-111">Moduł odporny na uszkodzenia FileX działa zgodnie z instrukcjami rejestrowania wymaganymi do zaktualizowania pliku *przed* zastosowaniem tych kroków do systemu plików.</span><span class="sxs-lookup"><span data-stu-id="539ca-111">The FileX Fault Tolerant Module works by journaling steps required to update a file *before* these steps are applied to the file system.</span></span> <span data-ttu-id="539ca-112">Jeśli aktualizacja pliku zakończyła się pomyślnie, te wpisy dziennika zostaną usunięte.</span><span class="sxs-lookup"><span data-stu-id="539ca-112">If the file update is successful, these log entries are removed.</span></span> <span data-ttu-id="539ca-113">Jeśli jednak Aktualizacja pliku zostanie przerwana, wpisy dziennika są przechowywane na nośniku.</span><span class="sxs-lookup"><span data-stu-id="539ca-113">However, if the file update is interrupted, the log entries are stored on the media.</span></span> <span data-ttu-id="539ca-114">Podczas następnego montowania nośnika FileX wykrywa te wpisy dziennika z poprzedniej (nieukończonej) operacji zapisu.</span><span class="sxs-lookup"><span data-stu-id="539ca-114">Next time the media is mounted, FileX detects these log entries from the previous (unfinished) write operation.</span></span> <span data-ttu-id="539ca-115">W takich przypadkach FileX może odzyskać sprawność po awarii przez wycofanie zmian już wprowadzonych w systemie plików lub przez ponowne zastosowanie wymaganych zmian w celu ukończenia poprzedniej operacji.</span><span class="sxs-lookup"><span data-stu-id="539ca-115">In such cases, FileX can recover from a failure by either rolling back the changes already made to the file system, or by reapplying the required changes to complete the previous operation.</span></span> <span data-ttu-id="539ca-116">W ten sposób moduł odporny na uszkodzenia FileX zachowuje integralność systemu plików, jeśli nośnik utraci moc podczas operacji aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="539ca-116">In this way, the FileX Fault Tolerant Module maintains file system integrity if the media loses power during an update operation.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="539ca-117">*Moduł odporny na uszkodzenia FileX nie został zaprojektowany, aby zapobiec uszkodzeniu systemu plików spowodowanym uszkodzeniem nośnika fizycznego z prawidłowymi danymi.*</span><span class="sxs-lookup"><span data-stu-id="539ca-117">*The FileX Fault Tolerant Module is not designed to prevent file system corruption caused by physical media corruption with valid data in it.*</span></span>

> [!IMPORTANT]
> <span data-ttu-id="539ca-118">*Gdy moduł odporny na uszkodzenia FileX chroni nośnik, nośnik nie może być instalowany przez coś innego niż FileX z włączonym odpornością na uszkodzenia. Wykonanie tej operacji może spowodować niespójność wpisów dziennika w systemie plików z informacjami o systemie na nośniku. Jeśli moduł odporny na uszkodzenia FileX próbuje przetworzyć wpisy dziennika po zaktualizowaniu nośnika przez inny system plików, procedura odzyskiwania może zakończyć się niepowodzeniem, pozostawiając cały system plików w stanie nieprzewidywalnym.*</span><span class="sxs-lookup"><span data-stu-id="539ca-118">*After the FileX Fault Tolerant module protects a media, the media must not be mounted by anything other than FileX with Fault Tolerant enabled. Doing so can cause the log entries in the file system to be inconsistent with system information on the media. If the FileX Fault Tolerant module attempts to process log entries after the media is updated by another file system, the recovery procedure may fail, leaving the entire file system in an unpredictable state.*</span></span>

## <a name="use-of-the-fault-tolerant-module"></a><span data-ttu-id="539ca-119">Korzystanie z modułu odpornego na uszkodzenia</span><span class="sxs-lookup"><span data-stu-id="539ca-119">Use of the Fault Tolerant Module</span></span>

<span data-ttu-id="539ca-120">Funkcja odporna na uszkodzenia FileX jest dostępna dla wszystkich systemów plików FAT obsługiwanych przez FileX, w tym FAT12, FAT16, FAT32 i exFAT.</span><span class="sxs-lookup"><span data-stu-id="539ca-120">The FileX Fault Tolerant feature is available to all FAT file systems supported by FileX, including FAT12, FAT16, FAT32, and exFAT.</span></span> <span data-ttu-id="539ca-121">Aby włączyć funkcję odporną na uszkodzenia, FileX musi być skompilowana przy użyciu zdefiniowanego symbolu **FX_ENABLE_FAULT_TOLERANT** .</span><span class="sxs-lookup"><span data-stu-id="539ca-121">To enable the fault tolerant feature, FileX must be built with the symbol **FX_ENABLE_FAULT_TOLERANT** defined.</span></span> <span data-ttu-id="539ca-122">W czasie wykonywania aplikacja uruchamia usługę odporną na uszkodzenia, wywołując **_fx_fault_tolerant_enable_*_ bezpośrednio po wywołaniu _*_fx_media_open_**.</span><span class="sxs-lookup"><span data-stu-id="539ca-122">At run time, application starts fault tolerant service by calling **_fx_fault_tolerant_enable_*_ immediately after the call to _*_fx_media_open_**.</span></span> <span data-ttu-id="539ca-123">Po włączeniu odporności na uszkodzenia wszystkie operacje zapisu plików na wydzielonym nośniku są chronione.</span><span class="sxs-lookup"><span data-stu-id="539ca-123">After fault tolerant is enabled, all file write operations to the designated media are protected.</span></span> <span data-ttu-id="539ca-124">Domyślnie moduł odporny na uszkodzenia nie jest włączony.</span><span class="sxs-lookup"><span data-stu-id="539ca-124">By default the fault tolerant module is not enabled.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="539ca-125">\* Aplikacja musi upewnić się, że nie można uzyskać dostępu do systemu plików przed \***fx_fault_tolerant_enable** _.</span><span class="sxs-lookup"><span data-stu-id="539ca-125">\*Application needs to make sure the file system is not being accessed prior to \***fx_fault_tolerant_enable** _ being called.</span></span> <span data-ttu-id="539ca-126">Jeśli aplikacja zapisuje dane w systemie plików przed włączeniem odporności na uszkodzenia, operacja zapisu może uszkodzić nośnik, jeśli wcześniejsze operacje zapisu nie zostały ukończone i system plików nie został przywrócony przy użyciu dziennika odpornego na błędy entries._</span><span class="sxs-lookup"><span data-stu-id="539ca-126">If application writes data to the file system prior to fault tolerant enable, the write operation could corrupt the media if prior write operations were not completed, and the file system was not restored using fault tolerant log entries._</span></span>

## <a name="filex-fault-tolerant-module-log"></a><span data-ttu-id="539ca-127">Dziennik modułu odporny na błędy FileX</span><span class="sxs-lookup"><span data-stu-id="539ca-127">FileX Fault Tolerant Module Log</span></span>

<span data-ttu-id="539ca-128">Dziennik odporny na błędy FileX w programie Flash zajmuje jeden klaster logiczny.</span><span class="sxs-lookup"><span data-stu-id="539ca-128">The FileX fault tolerant log takes up one logical cluster in flash.</span></span> <span data-ttu-id="539ca-129">Indeks początkowego numeru klastra tego klastra jest rejestrowany w sektorze rozruchowym nośnika, z przesunięciem określonym przez symbol **FX_FAULT_TOLERANT_BOOT_INDEX**.</span><span class="sxs-lookup"><span data-stu-id="539ca-129">The index to the starting cluster number of that cluster is recorded in the boot sector of the media, with an offset specified by the symbol **FX_FAULT_TOLERANT_BOOT_INDEX**.</span></span> <span data-ttu-id="539ca-130">Domyślnie ten symbol jest zdefiniowany jako 116.</span><span class="sxs-lookup"><span data-stu-id="539ca-130">By default this symbol is defined to be 116.</span></span> <span data-ttu-id="539ca-131">Ta lokalizacja jest wybierana, ponieważ jest oznaczona jako zastrzeżona w specyfikacji FAT12/16/32 i exFAT.</span><span class="sxs-lookup"><span data-stu-id="539ca-131">This location is chosen because it is marked as reserved in FAT12/ 16/32 and exFAT specification.</span></span>

<span data-ttu-id="539ca-132">Rysunek 5 "układ struktury dziennika" pokazuje ogólny układ struktury dziennika.</span><span class="sxs-lookup"><span data-stu-id="539ca-132">Figure 5, "Log Structure Layout," shows the general layout of the log structure.</span></span> <span data-ttu-id="539ca-133">Struktura dziennika zawiera trzy sekcje: nagłówek dziennika, łańcuch tłuszczu i wpisy dziennika.</span><span class="sxs-lookup"><span data-stu-id="539ca-133">The log structure contains three sections: Log Header, FAT Chain, and Log Entries.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="539ca-134">*Wszystkie wartości wielobajtowe przechowywane w wpisach dziennika są w formacie little-endian.*</span><span class="sxs-lookup"><span data-stu-id="539ca-134">*All multi-byte values stored in the log entries are in Little Endian format.*</span></span>

![Układ struktury dziennika](./media/user-guide/log-structure-layout.png)

<span data-ttu-id="539ca-136">**Rysunek 5. Układ struktury dziennika**</span><span class="sxs-lookup"><span data-stu-id="539ca-136">**Figure 5. Log Structure Layout**</span></span>

<span data-ttu-id="539ca-137">Obszar nagłówka dziennika zawiera informacje opisujące całą strukturę dziennika i szczegółowo objaśnia każde pole.</span><span class="sxs-lookup"><span data-stu-id="539ca-137">The Log Header area contains information that describes the entire log structure and explains each field in detail.</span></span>

<span data-ttu-id="539ca-138">**TABELA 8. Obszar nagłówka dziennika**</span><span class="sxs-lookup"><span data-stu-id="539ca-138">**TABLE 8. Log Header Area**</span></span>

|<span data-ttu-id="539ca-139">Pole</span><span class="sxs-lookup"><span data-stu-id="539ca-139">Field</span></span>|<span data-ttu-id="539ca-140">Rozmiar (w bajtach)</span><span class="sxs-lookup"><span data-stu-id="539ca-140">Size(in bytes)</span></span>|<span data-ttu-id="539ca-141">Opis</span><span class="sxs-lookup"><span data-stu-id="539ca-141">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="539ca-142">ID (Identyfikator)</span><span class="sxs-lookup"><span data-stu-id="539ca-142">ID</span></span>|<span data-ttu-id="539ca-143">4</span><span class="sxs-lookup"><span data-stu-id="539ca-143">4</span></span>|<span data-ttu-id="539ca-144">Identyfikuje strukturę dziennika odpornego na błędy FileX.</span><span class="sxs-lookup"><span data-stu-id="539ca-144">Identifies a FileX Fault Tolerant Log structure.</span></span> <span data-ttu-id="539ca-145">Struktura dziennika jest uważana za nieprawidłową, jeśli wartość identyfikatora nie jest 0x46544C52.</span><span class="sxs-lookup"><span data-stu-id="539ca-145">The log structure is considered invalid if the ID value is not 0x46544C52.</span></span>|
|<span data-ttu-id="539ca-146">Łączny rozmiar</span><span class="sxs-lookup"><span data-stu-id="539ca-146">Total Size</span></span>|<span data-ttu-id="539ca-147">2</span><span class="sxs-lookup"><span data-stu-id="539ca-147">2</span></span>|<span data-ttu-id="539ca-148">Wskazuje łączny rozmiar (w bajtach) całej struktury dziennika.</span><span class="sxs-lookup"><span data-stu-id="539ca-148">Indicates the total size (in bytes) of the entire log structure.</span></span>|
|<span data-ttu-id="539ca-149">Suma kontrolna nagłówka</span><span class="sxs-lookup"><span data-stu-id="539ca-149">Header Checksum</span></span>|<span data-ttu-id="539ca-150">2</span><span class="sxs-lookup"><span data-stu-id="539ca-150">2</span></span>|<span data-ttu-id="539ca-151">Suma kontrolna, która konwertuje obszar nagłówka dziennika.</span><span class="sxs-lookup"><span data-stu-id="539ca-151">Checksum that converts the log header area.</span></span> <span data-ttu-id="539ca-152">Struktura dziennika jest uważana za nieprawidłową, jeśli pola nagłówka nie powiodą się weryfikacja sumy kontrolnej.</span><span class="sxs-lookup"><span data-stu-id="539ca-152">The log structure is considered invalid if the header fields fail the checksum verification.</span></span>|
|<span data-ttu-id="539ca-153">Numer wersji</span><span class="sxs-lookup"><span data-stu-id="539ca-153">Version Number</span></span>|<span data-ttu-id="539ca-154">2</span><span class="sxs-lookup"><span data-stu-id="539ca-154">2</span></span>|<span data-ttu-id="539ca-155">FileX odporne na uszkodzenia i wersje główne i pomocnicze.</span><span class="sxs-lookup"><span data-stu-id="539ca-155">FileX Fault Tolerant major and minor version numbers.</span></span>|
|<span data-ttu-id="539ca-156">Zarezerwowany</span><span class="sxs-lookup"><span data-stu-id="539ca-156">Reserved</span></span>|<span data-ttu-id="539ca-157">2</span><span class="sxs-lookup"><span data-stu-id="539ca-157">2</span></span>|<span data-ttu-id="539ca-158">Do przyszłego rozwinięcia.</span><span class="sxs-lookup"><span data-stu-id="539ca-158">For future expansion.</span></span>|

<span data-ttu-id="539ca-159">Po zakończeniu obszaru nagłówka dziennika następuje obszar dziennika łańcucha FAT.</span><span class="sxs-lookup"><span data-stu-id="539ca-159">The Log Header area is followed by the FAT Chain Log area.</span></span> <span data-ttu-id="539ca-160">Rysunek 9 zawiera informacje opisujące sposób modyfikacji łańcucha FAT.</span><span class="sxs-lookup"><span data-stu-id="539ca-160">Figure 9 contains information that describes how the FAT chain should be modified.</span></span> <span data-ttu-id="539ca-161">Ten obszar dziennika zawiera informacje dotyczące klastrów przypisywanych do pliku, klastrów usuwanych z pliku oraz miejsca, w których należy wstawić/usunąć, i opis poszczególnych pól w obszarze dziennika łańcucha FAT.</span><span class="sxs-lookup"><span data-stu-id="539ca-161">This log area contains information on the clusters being allocated to a file, the clusters being removed from a file, and where the insertion/deletion should be and describes each field in the FAT Chain Log area.</span></span>

<span data-ttu-id="539ca-162">**TABELA 9. Obszar dziennika łańcucha FAT**</span><span class="sxs-lookup"><span data-stu-id="539ca-162">**TABLE 9. FAT Chain Log Area**</span></span>

|<span data-ttu-id="539ca-163">Pole</span><span class="sxs-lookup"><span data-stu-id="539ca-163">Field</span></span>|<span data-ttu-id="539ca-164">Rozmiar (w bajtach)</span><span class="sxs-lookup"><span data-stu-id="539ca-164">Size(in bytes)</span></span>|<span data-ttu-id="539ca-165">Opis</span><span class="sxs-lookup"><span data-stu-id="539ca-165">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="539ca-166">Suma kontrolna dziennika łańcucha FAT</span><span class="sxs-lookup"><span data-stu-id="539ca-166">FAT Chain Log Checksum</span></span>|<span data-ttu-id="539ca-167">2</span><span class="sxs-lookup"><span data-stu-id="539ca-167">2</span></span>|<span data-ttu-id="539ca-168">Suma kontrolna całego obszaru dziennika łańcucha FAT.</span><span class="sxs-lookup"><span data-stu-id="539ca-168">Checksum of the entire FAT Chain Log area.</span></span> <span data-ttu-id="539ca-169">Obszar dziennika łańcucha FAT jest uznawany za nieprawidłowy, jeśli nie powiedzie się weryfikacja sumy kontrolnej.</span><span class="sxs-lookup"><span data-stu-id="539ca-169">The FAT Chain Log area is considered invalid if the it fails the checksum verification.</span></span>|
|<span data-ttu-id="539ca-170">Flaga</span><span class="sxs-lookup"><span data-stu-id="539ca-170">Flag</span></span>|<span data-ttu-id="539ca-171">1</span><span class="sxs-lookup"><span data-stu-id="539ca-171">1</span></span>|<span data-ttu-id="539ca-172">Prawidłowe wartości flag to:</span><span class="sxs-lookup"><span data-stu-id="539ca-172">Valid flag values are:</span></span><br/><span data-ttu-id="539ca-173">Prawidłowy łańcuch systemu plików FAT 0x01</span><span class="sxs-lookup"><span data-stu-id="539ca-173">0x01 FAT Chain Valid</span></span><br /><span data-ttu-id="539ca-174">0x02 Mapa bitowa jest używana</span><span class="sxs-lookup"><span data-stu-id="539ca-174">0x02 BITMAP is being used</span></span>|
|<span data-ttu-id="539ca-175">Zarezerwowany</span><span class="sxs-lookup"><span data-stu-id="539ca-175">Reserved</span></span>|<span data-ttu-id="539ca-176">1</span><span class="sxs-lookup"><span data-stu-id="539ca-176">1</span></span>|<span data-ttu-id="539ca-177">Zarezerwowane do użytku w przyszłości</span><span class="sxs-lookup"><span data-stu-id="539ca-177">Reserved for future use</span></span>|
|<span data-ttu-id="539ca-178">Punkt wstawiania — przód</span><span class="sxs-lookup"><span data-stu-id="539ca-178">Insertion Point – Front</span></span>|<span data-ttu-id="539ca-179">4</span><span class="sxs-lookup"><span data-stu-id="539ca-179">4</span></span>|<span data-ttu-id="539ca-180">Klaster (należący do oryginalnego łańcucha FAT), w którym ma zostać dołączony nowo utworzony łańcuch.</span><span class="sxs-lookup"><span data-stu-id="539ca-180">The cluster (that belongs to the original FAT chain) where the newly created chain is going to be attached to.</span></span>|
|<span data-ttu-id="539ca-181">Klaster główny nowego łańcucha FAT</span><span class="sxs-lookup"><span data-stu-id="539ca-181">Head Cluster of New FAT Chain</span></span>|<span data-ttu-id="539ca-182">4</span><span class="sxs-lookup"><span data-stu-id="539ca-182">4</span></span>|<span data-ttu-id="539ca-183">Pierwszy klaster nowo utworzonego łańcucha FAT</span><span class="sxs-lookup"><span data-stu-id="539ca-183">The first cluster of the newly created FAT Chain</span></span>|
|<span data-ttu-id="539ca-184">Główny klaster oryginalnego łańcucha FAT</span><span class="sxs-lookup"><span data-stu-id="539ca-184">Head Cluster of Original FAT Chain</span></span>|<span data-ttu-id="539ca-185">4</span><span class="sxs-lookup"><span data-stu-id="539ca-185">4</span></span>|<span data-ttu-id="539ca-186">Pierwszy klaster części oryginalnego łańcucha FAT, który ma zostać usunięty.</span><span class="sxs-lookup"><span data-stu-id="539ca-186">The first cluster of the portion of the original FAT Chain that is to be removed.</span></span>|
|<span data-ttu-id="539ca-187">Punkt wstawiania — wstecz</span><span class="sxs-lookup"><span data-stu-id="539ca-187">Insertion Point – Back</span></span>|<span data-ttu-id="539ca-188">4</span><span class="sxs-lookup"><span data-stu-id="539ca-188">4</span></span>|<span data-ttu-id="539ca-189">Oryginalny klaster, w którym jest przyłączany nowo utworzony łańcuch systemu plików FAT.</span><span class="sxs-lookup"><span data-stu-id="539ca-189">The original cluster where the newly created FAT chain joins at.</span></span>|
|<span data-ttu-id="539ca-190">Następny punkt usuwania</span><span class="sxs-lookup"><span data-stu-id="539ca-190">Next Deletion Point</span></span>|<span data-ttu-id="539ca-191">4</span><span class="sxs-lookup"><span data-stu-id="539ca-191">4</span></span>|<span data-ttu-id="539ca-192">To pole ułatwia procedurę oczyszczania łańcucha FAT.</span><span class="sxs-lookup"><span data-stu-id="539ca-192">This field assists the FAT chain cleanup procedure.</span></span>|

<span data-ttu-id="539ca-193">Obszar wpisy dziennika zawiera wpisy dziennika opisujące zmiany, które są konieczne do odzyskania po awarii.</span><span class="sxs-lookup"><span data-stu-id="539ca-193">The Log Entries Area contains log entries that describe the changes needed to recover from a failure.</span></span> <span data-ttu-id="539ca-194">W module odporny na błędy FileX są obsługiwane trzy typy wpisów dziennika: wpis dziennika FAT; Wpis dziennika katalogu; i wpis dziennika mapy bitowej.</span><span class="sxs-lookup"><span data-stu-id="539ca-194">There are three types of log entry supported in the FileX fault tolerant module: FAT Log Entry; Directory Log Entry; and Bitmap Log Entry.</span></span>

<span data-ttu-id="539ca-195">Poniższe trzy ilustracje i trzy tabele opisują te wpisy dziennika szczegółowo.</span><span class="sxs-lookup"><span data-stu-id="539ca-195">The following three figures and three tables describe these log entries in detail.</span></span>

![Wpis dziennika FAT](./media/user-guide/fat-log-entry.png)

<span data-ttu-id="539ca-197">**Rysunek 6. Wpis dziennika FAT**</span><span class="sxs-lookup"><span data-stu-id="539ca-197">**Figure 6. FAT Log Entry**</span></span>

<span data-ttu-id="539ca-198">**TABELA 10. Wpis dziennika FAT**</span><span class="sxs-lookup"><span data-stu-id="539ca-198">**TABLE 10. FAT Log Entry**</span></span>

|<span data-ttu-id="539ca-199">Pole</span><span class="sxs-lookup"><span data-stu-id="539ca-199">Field</span></span>|<span data-ttu-id="539ca-200">Rozmiar (w bajtach)</span><span class="sxs-lookup"><span data-stu-id="539ca-200">Size(in bytes)</span></span>|<span data-ttu-id="539ca-201">Opis</span><span class="sxs-lookup"><span data-stu-id="539ca-201">Description</span></span>|
|-----|--------------|-----------|
<span data-ttu-id="539ca-202">Typ</span><span class="sxs-lookup"><span data-stu-id="539ca-202">Type</span></span>|<span data-ttu-id="539ca-203">2</span><span class="sxs-lookup"><span data-stu-id="539ca-203">2</span></span>|<span data-ttu-id="539ca-204">Typ wpisu musi być FX_FAULT_TOLERANT_FAT_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="539ca-204">Type of Entry, must be FX_FAULT_TOLERANT_FAT_LOG_TYPE</span></span>|
|<span data-ttu-id="539ca-205">Rozmiar</span><span class="sxs-lookup"><span data-stu-id="539ca-205">Size</span></span>|<span data-ttu-id="539ca-206">2</span><span class="sxs-lookup"><span data-stu-id="539ca-206">2</span></span>|<span data-ttu-id="539ca-207">Rozmiar tego wpisu</span><span class="sxs-lookup"><span data-stu-id="539ca-207">Size of this entry</span></span>|
|<span data-ttu-id="539ca-208">Numer klastra</span><span class="sxs-lookup"><span data-stu-id="539ca-208">Cluster Number</span></span>|<span data-ttu-id="539ca-209">4</span><span class="sxs-lookup"><span data-stu-id="539ca-209">4</span></span>|<span data-ttu-id="539ca-210">Numer klastra</span><span class="sxs-lookup"><span data-stu-id="539ca-210">Cluster number</span></span>|
|<span data-ttu-id="539ca-211">Wartość</span><span class="sxs-lookup"><span data-stu-id="539ca-211">Value</span></span>|<span data-ttu-id="539ca-212">4</span><span class="sxs-lookup"><span data-stu-id="539ca-212">4</span></span>|<span data-ttu-id="539ca-213">Wartość, która ma być zapisywana we wpisie systemu FAT</span><span class="sxs-lookup"><span data-stu-id="539ca-213">Value to be written into the FAT entry</span></span>|

![Wpis dziennika katalogu](./media/user-guide/directory-log-entry.png)

<span data-ttu-id="539ca-215">**Rysunek 7. Wpis dziennika katalogu**</span><span class="sxs-lookup"><span data-stu-id="539ca-215">**Figure 7. Directory Log Entry**</span></span>

<span data-ttu-id="539ca-216">**TABELA 11. Wpis dziennika katalogu**</span><span class="sxs-lookup"><span data-stu-id="539ca-216">**TABLE 11. Directory Log Entry**</span></span>

|<span data-ttu-id="539ca-217">Pole</span><span class="sxs-lookup"><span data-stu-id="539ca-217">Field</span></span>|<span data-ttu-id="539ca-218">Rozmiar (w bajtach)</span><span class="sxs-lookup"><span data-stu-id="539ca-218">Size(in bytes)</span></span>|<span data-ttu-id="539ca-219">Opis</span><span class="sxs-lookup"><span data-stu-id="539ca-219">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="539ca-220">Typ</span><span class="sxs-lookup"><span data-stu-id="539ca-220">Type</span></span>|<span data-ttu-id="539ca-221">2</span><span class="sxs-lookup"><span data-stu-id="539ca-221">2</span></span>|<span data-ttu-id="539ca-222">Typ wpisu musi być FX_FAULT_TOLERANT_DIRECTORY_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="539ca-222">Type of Entry, must be FX_FAULT_TOLERANT_DIRECTORY_LOG_TYPE</span></span>|
|<span data-ttu-id="539ca-223">Rozmiar</span><span class="sxs-lookup"><span data-stu-id="539ca-223">Size</span></span>|<span data-ttu-id="539ca-224">2</span><span class="sxs-lookup"><span data-stu-id="539ca-224">2</span></span>|<span data-ttu-id="539ca-225">Rozmiar tego wpisu</span><span class="sxs-lookup"><span data-stu-id="539ca-225">Size of this entry</span></span>|
|<span data-ttu-id="539ca-226">Przesunięcie sektora</span><span class="sxs-lookup"><span data-stu-id="539ca-226">Sector Offset</span></span>|<span data-ttu-id="539ca-227">4</span><span class="sxs-lookup"><span data-stu-id="539ca-227">4</span></span>|<span data-ttu-id="539ca-228">Przesunięcie (w bajtach) do sektora, w którym znajduje się ten katalog.</span><span class="sxs-lookup"><span data-stu-id="539ca-228">Offset (in bytes) into the sector where this directory is located.</span></span>|
|<span data-ttu-id="539ca-229">Sektor dziennika</span><span class="sxs-lookup"><span data-stu-id="539ca-229">Log Sector</span></span>|<span data-ttu-id="539ca-230">4</span><span class="sxs-lookup"><span data-stu-id="539ca-230">4</span></span>|<span data-ttu-id="539ca-231">Sektor, w którym znajduje się wpis katalogu</span><span class="sxs-lookup"><span data-stu-id="539ca-231">The sector where the directory entry is located</span></span>|
|<span data-ttu-id="539ca-232">Dane dziennika</span><span class="sxs-lookup"><span data-stu-id="539ca-232">Log Data</span></span>|<span data-ttu-id="539ca-233">Zmienna</span><span class="sxs-lookup"><span data-stu-id="539ca-233">Variable</span></span>|<span data-ttu-id="539ca-234">Zawartość wpisu katalogu</span><span class="sxs-lookup"><span data-stu-id="539ca-234">Content of the directory entry</span></span>|

![Wpis dziennika mapy bitowej](./media/user-guide/bitmap-log-entry.png)

<span data-ttu-id="539ca-236">**Rysunek 8. Wpis dziennika mapy bitowej**</span><span class="sxs-lookup"><span data-stu-id="539ca-236">**Figure 8. Bitmap Log Entry**</span></span>

<span data-ttu-id="539ca-237">**TABELA 12. Wpis dziennika mapy bitowej**</span><span class="sxs-lookup"><span data-stu-id="539ca-237">**TABLE 12. Bitmap Log Entry**</span></span>

|<span data-ttu-id="539ca-238">Pole</span><span class="sxs-lookup"><span data-stu-id="539ca-238">Field</span></span>|<span data-ttu-id="539ca-239">Rozmiar (w bajtach)</span><span class="sxs-lookup"><span data-stu-id="539ca-239">Size(in bytes)</span></span>|<span data-ttu-id="539ca-240">Opis</span><span class="sxs-lookup"><span data-stu-id="539ca-240">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="539ca-241">Typ</span><span class="sxs-lookup"><span data-stu-id="539ca-241">Type</span></span>|<span data-ttu-id="539ca-242">2</span><span class="sxs-lookup"><span data-stu-id="539ca-242">2</span></span>|<span data-ttu-id="539ca-243">Typ wpisu musi być FX_FAULT_TOLERANT_BITMAP_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="539ca-243">Type of Entry, must be FX_FAULT_TOLERANT_BITMAP_LOG_TYPE</span></span>|
|<span data-ttu-id="539ca-244">Rozmiar</span><span class="sxs-lookup"><span data-stu-id="539ca-244">Size</span></span>|<span data-ttu-id="539ca-245">2</span><span class="sxs-lookup"><span data-stu-id="539ca-245">2</span></span>|<span data-ttu-id="539ca-246">Rozmiar tego wpisu</span><span class="sxs-lookup"><span data-stu-id="539ca-246">Size of this entry</span></span>|
|<span data-ttu-id="539ca-247">Numer klastra</span><span class="sxs-lookup"><span data-stu-id="539ca-247">Cluster Number</span></span>|<span data-ttu-id="539ca-248">4</span><span class="sxs-lookup"><span data-stu-id="539ca-248">4</span></span>|<span data-ttu-id="539ca-249">Numer klastra</span><span class="sxs-lookup"><span data-stu-id="539ca-249">Cluster number</span></span>|
|<span data-ttu-id="539ca-250">Wartość</span><span class="sxs-lookup"><span data-stu-id="539ca-250">Value</span></span>|<span data-ttu-id="539ca-251">4</span><span class="sxs-lookup"><span data-stu-id="539ca-251">4</span></span>|<span data-ttu-id="539ca-252">Wartość, która ma być zapisywana we wpisie systemu FAT</span><span class="sxs-lookup"><span data-stu-id="539ca-252">Value to be written into the FAT entry</span></span>|

## <a name="fault-tolerant-protection"></a><span data-ttu-id="539ca-253">Ochrona odporna na uszkodzenia</span><span class="sxs-lookup"><span data-stu-id="539ca-253">Fault Tolerant Protection</span></span>

<span data-ttu-id="539ca-254">Po uruchomieniu modułu odpornego na błędy FileX najpierw szuka istniejącego pliku dziennika odpornego na błędy na nośniku.</span><span class="sxs-lookup"><span data-stu-id="539ca-254">After the FileX Fault Tolerant Module starts, it first searches for an existing fault tolerant log file in the media.</span></span> <span data-ttu-id="539ca-255">Jeśli nie można znaleźć prawidłowego pliku dziennika, FileX traktuje nośnik bez ochrony.</span><span class="sxs-lookup"><span data-stu-id="539ca-255">If a valid log file cannot be found, FileX considers the media unprotected.</span></span> <span data-ttu-id="539ca-256">W takim przypadku FileX utworzy plik dziennika odporny na uszkodzenia na nośniku.</span><span class="sxs-lookup"><span data-stu-id="539ca-256">In this case FileX will create a fault tolerant log file on the media.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="539ca-257">\* FileX nie jest w stanie chronić systemu plików, jeśli został uszkodzony przed uruchomieniem modułu odpornego na błędy FileX.</span><span class="sxs-lookup"><span data-stu-id="539ca-257">\*FileX is not able to protect a file system if it was corrupted before the FileX Fault Tolerant Module starts.</span></span> *

<span data-ttu-id="539ca-258">Jeśli zlokalizowany jest plik dziennika odporny na błędy, FileX sprawdza obecność istniejących wpisów dziennika.</span><span class="sxs-lookup"><span data-stu-id="539ca-258">If a fault tolerant log file is located, FileX checks for existing log entries.</span></span> <span data-ttu-id="539ca-259">Plik dziennika bez wpisu dziennika wskazuje, że wcześniejsza operacja pliku zakończyła się pomyślnie, a wszystkie wpisy dziennika zostały usunięte.</span><span class="sxs-lookup"><span data-stu-id="539ca-259">A log file with no log entry indicates prior file operation was successful, and all log entries were removed.</span></span> <span data-ttu-id="539ca-260">W takim przypadku aplikacja może zacząć korzystać z systemu plików z ochroną odporną na błędy.</span><span class="sxs-lookup"><span data-stu-id="539ca-260">In this case the application can start using the file system with fault tolerant protection.</span></span>

<span data-ttu-id="539ca-261">Jeśli jednak znajdują się wpisy dziennika, FileX musi wykonać poprzednią operację pliku lub przywrócić zmiany, które zostały już zastosowane do systemu plików, skutecznie cofnąć zmiany.</span><span class="sxs-lookup"><span data-stu-id="539ca-261">However if log entries are located, FileX needs to either complete the prior file operation, or revert the changes already applied to the file system, effectively undo the changes.</span></span> <span data-ttu-id="539ca-262">W obu przypadkach po zastosowaniu wpisów dziennika do systemu plików system plików jest przywracany w spójny stan, a aplikacja może ponownie rozpocząć korzystanie z systemu plików.</span><span class="sxs-lookup"><span data-stu-id="539ca-262">In either case, after the log entries are applied to the file system, the file system is restored into a coherent state, and application can start using the file system again.</span></span>

<span data-ttu-id="539ca-263">W przypadku multimediów chronionych przez FileX podczas operacji aktualizowania pliku część danych jest zapisywana bezpośrednio na nośniku.</span><span class="sxs-lookup"><span data-stu-id="539ca-263">For media protected by FileX, during file update operation, the data portion is written directly to the media.</span></span> <span data-ttu-id="539ca-264">Ponieważ FileX zapisuje dane, rejestruje także wszelkie zmiany, które trzeba zastosować do wpisów w katalogu, tabeli FAT.</span><span class="sxs-lookup"><span data-stu-id="539ca-264">As FileX writes data, it also records any changes needed to be applied to directory entries, FAT table.</span></span> <span data-ttu-id="539ca-265">Te informacje są rejestrowane w dziennikach odpornych na pliki.</span><span class="sxs-lookup"><span data-stu-id="539ca-265">This information is recorded in the file tolerant log entries.</span></span> <span data-ttu-id="539ca-266">To podejście gwarantuje, że aktualizacje systemu plików są wykonywane po zapisaniu danych na nośniku.</span><span class="sxs-lookup"><span data-stu-id="539ca-266">This approach guarantees that updates to the file system occur after the data is written to the media.</span></span> <span data-ttu-id="539ca-267">Jeśli nośnik zostanie wysunięty w fazie zapisu danych, podstawowe informacje o systemie plików nie zostały jeszcze zmienione.</span><span class="sxs-lookup"><span data-stu-id="539ca-267">If the media is ejected during the data-write phase, crucial file system information has not been changed yet.</span></span> <span data-ttu-id="539ca-268">W związku z tym system plików nie ma wpływ na przerwy.</span><span class="sxs-lookup"><span data-stu-id="539ca-268">Therefore the file system is not affected by the interruption.</span></span>

<span data-ttu-id="539ca-269">Po pomyślnym zapisaniu wszystkich danych na nośniku FileX następnie postępuj zgodnie z informacjami w wpisach dziennika, aby zastosować zmiany do informacji o systemie, po jednym wpisie.</span><span class="sxs-lookup"><span data-stu-id="539ca-269">After all the data is successfully written to the media, FileX then follows information in the log entries to applies the changes to system information, one entry at a time.</span></span> <span data-ttu-id="539ca-270">Po zatwierdzeniu wszystkich informacji o systemie na nośniku wpisy dziennika są usuwane z dziennika odpornego na błędy.</span><span class="sxs-lookup"><span data-stu-id="539ca-270">After all the system information is committed to the media, the log entries are removed from the fault tolerant log.</span></span> <span data-ttu-id="539ca-271">W tym momencie FileX wykonuje operację aktualizacji pliku.</span><span class="sxs-lookup"><span data-stu-id="539ca-271">At this point, FileX completes the file update operation.</span></span>

<span data-ttu-id="539ca-272">Podczas operacji aktualizowania pliku pliki nie są aktualizowane na miejscu.</span><span class="sxs-lookup"><span data-stu-id="539ca-272">During file update operation, files are not updated in place.</span></span> <span data-ttu-id="539ca-273">Moduł odporny na uszkodzenia przydziela sektora danych, aby zapisać nowe dane w, a następnie usunąć sektor zawierający dane przeznaczone do zastąpienia, aktualizując powiązane wpisy systemu FAT w celu połączenia nowego sektora z Chian.</span><span class="sxs-lookup"><span data-stu-id="539ca-273">The fault tolerant module allocates a sector for the data to write the new data into, and then remove the sector that contains the data to be overwritten, updating related FAT entries to link the new sector into the chian.</span></span> <span data-ttu-id="539ca-274">W sytuacjach, w których należy zmodyfikować częściowe dane w klastrze, FileX zawsze przydziela nowe klastry, zapisuje wszystkie dane ze starych klastrów ze zaktualizowanymi danymi w nowych klastrach, a następnie zwalnia stare klastry.</span><span class="sxs-lookup"><span data-stu-id="539ca-274">For situations in which partial data in a cluster needs to be modified, FileX always allocates new clusters, writes the entire data from the old clusters with updated data into the new clusters, then frees up the old clusters.</span></span> <span data-ttu-id="539ca-275">Gwarantuje to, że jeśli aktualizacja pliku zostanie przerwana, oryginalny plik jest nienaruszony.</span><span class="sxs-lookup"><span data-stu-id="539ca-275">This guarantees that if the file update is interrupted, the original file is intact.</span></span> <span data-ttu-id="539ca-276">Aplikacja musi mieć świadomość, że w obszarze Ochrona odporna na uszkodzenia FileX aktualizacja danych w pliku wymaga, aby nośnik miał wystarczającą ilość wolnego miejsca do przechowywania nowych danych przed udostępnieniem sektorów ze starymi danymi.</span><span class="sxs-lookup"><span data-stu-id="539ca-276">The application needs to be aware that under FileX fault tolerant protection, updating data in a file requires the media to have enough free space to hold new data before sectors with old data can be released.</span></span> <span data-ttu-id="539ca-277">Jeśli nośnik nie ma wystarczającej ilości miejsca do przechowywania nowych danych, operacja aktualizacji zakończy się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="539ca-277">If the media doesn't have enough space to hold new data, the update operation fails.</span></span>
