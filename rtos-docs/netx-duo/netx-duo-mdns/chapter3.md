---
title: Rozdział 3 — Opis pamięci podręcznej usługi wewnętrznej
description: 'Moduł mDNS programu NetX Duo zarządza dwiema pamięciami podręcznymi usług wewnętrznych: lokalną pamięć podręczną usługi i równorzędną pamięć podręczną usługi.'
author: philmea
ms.author: philmea
ms.date: 07/09/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 007f1080a076730cfbcdedc9f063ac0c427a414c
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/22/2021
ms.locfileid: "104821817"
---
# <a name="chapter-3---description-of-internal-service-cache"></a><span data-ttu-id="250ef-103">Rozdział 3 — Opis pamięci podręcznej usługi wewnętrznej</span><span class="sxs-lookup"><span data-stu-id="250ef-103">Chapter 3 - Description of internal service cache</span></span>

<span data-ttu-id="250ef-104">Moduł mDNS programu NetX Duo zarządza dwiema pamięciami podręcznymi usług wewnętrznych: lokalną pamięć podręczną usługi i równorzędną pamięć podręczną usługi.</span><span class="sxs-lookup"><span data-stu-id="250ef-104">NetX Duo mDNS module manages two internal services caches: the local service cache, and the peer service cache.</span></span> <span data-ttu-id="250ef-105">W pamięci podręcznej usługi lokalnej są przechowywane rekordy zasobów powiązane z usługami oferowanymi przez aplikacje działające w węźle.</span><span class="sxs-lookup"><span data-stu-id="250ef-105">The local service cache stores Resource Records related to services offered by applications running on the node.</span></span> <span data-ttu-id="250ef-106">W przypadku zapytań przychodzących, jeśli pytanie pasuje do oferowanej usługi, odpowiedzi mDNS z odpowiedziami przechowywanymi w lokalnej pamięci podręcznej usługi.</span><span class="sxs-lookup"><span data-stu-id="250ef-106">For incoming queries, if the question matches the service offered, mDNS responses with answers stored in the local service cache.</span></span> <span data-ttu-id="250ef-107">Aplikacje rejestrują usługi przez wywołanie interfejsu API *nx_mdns_service_add ()*.</span><span class="sxs-lookup"><span data-stu-id="250ef-107">Applications register services by calling the API *nx_mdns_service_add()*.</span></span> <span data-ttu-id="250ef-108">Aby usunąć usługi, aplikacje używają interfejsu API *nx_mdns_service_delete ()*, co spowoduje wysłanie komunikatów "pożegnania" przed usunięciem odpowiednich wpisów w lokalnej pamięci podręcznej usługi.</span><span class="sxs-lookup"><span data-stu-id="250ef-108">To remove services, applications use the API *nx_mdns_service_delete()*, which will in turn send "goodbye" messages before removing the corresponding entries in the local service cache.</span></span>

<span data-ttu-id="250ef-109">Po dodaniu usługi Usługa mDNS utrzymuje co najmniej 3 rekordy zasobów w lokalnej pamięci podręcznej usługi: SRV, PTR i TXT.</span><span class="sxs-lookup"><span data-stu-id="250ef-109">When a service is added, mDNS maintains at least 3 Resource Records in the local service cache: SRV, PTR, and TXT.</span></span> <span data-ttu-id="250ef-110">Jeśli typ usługi zawiera podtyp, można dodać dodatkowy rekord zasobu PTR.</span><span class="sxs-lookup"><span data-stu-id="250ef-110">Additional PTR Resource Record may be added if the service type includes subtype.</span></span> <span data-ttu-id="250ef-111">Na przykład aplikacja rejestruje usługę:</span><span class="sxs-lookup"><span data-stu-id="250ef-111">For example, an application registers a service:</span></span>

```
*name*._*subtype*._sub._*type*._tcp.local,
```

<span data-ttu-id="250ef-112">dwa rekordy zasobów PTR są dodawane do lokalnej pamięci podręcznej usługi, jeden dla</span><span class="sxs-lookup"><span data-stu-id="250ef-112">two PTR Resource Records are added to the local service cache, one for</span></span>

```
“*_subtype._*sub*._type._*tcp.local *PTR name.type._*tcp*.*local”
```

<span data-ttu-id="250ef-113">i drugi dla</span><span class="sxs-lookup"><span data-stu-id="250ef-113">and the other one for</span></span>

```
*“_type._*tcp*.*local *PTR name.type._*tcp*.*local”.
```

<span data-ttu-id="250ef-114">Pamięć podręczna usługi równorzędnej zawiera rekordy zasobów mDNS otrzymane z sąsiednich węzłów.</span><span class="sxs-lookup"><span data-stu-id="250ef-114">The peer service cache contains mDNS Resource Records received from neighboring nodes.</span></span> <span data-ttu-id="250ef-115">Moduł mDNS zbiera rekordy zasobów anonsowane przez inne węzły w sieci i zapisuje otrzymane informacje w pamięci podręcznej usługi równorzędnej.</span><span class="sxs-lookup"><span data-stu-id="250ef-115">mDNS module collects Resource Records advertised by other nodes on the network, and stores the received information in the peer service cache.</span></span> <span data-ttu-id="250ef-116">Gdy aplikacja wysyła zapytania dotyczące informacji, takich jak hosty IPv4 lub IPv6, usługa mDNS przeszukuje pamięć podręczną usługi równorzędnej pod kątem lokalnie zbuforowanych odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="250ef-116">When application queries for information such as host IPv4 or IPv6 addresses, mDNS searches the peer service cache for locally cached responses.</span></span> <span data-ttu-id="250ef-117">Gdy zapytania aplikacji dotyczące usług oferowanych przez elementy równorzędne, usługa mDNS przeszukuje pamięć podręczną w poszukiwaniu powiązanych rekordów adresów PTR, SRV, TXT i IPv4/IPv6.</span><span class="sxs-lookup"><span data-stu-id="250ef-117">When application queries for services offered by peers, mDNS searches through the cache for related PTR, SRV, TXT, and IPv4/IPv6 address records.</span></span> <span data-ttu-id="250ef-118">Pamięć podręczna usługi równorzędnej przechowuje również zapytania wysyłane do węzła.</span><span class="sxs-lookup"><span data-stu-id="250ef-118">The peer service cache also stores queries sent to the node.</span></span> <span data-ttu-id="250ef-119">Na przykład aplikacja może zażądać określonej usługi przez wywołanie *nx_mdns_service_one_shot_query.*</span><span class="sxs-lookup"><span data-stu-id="250ef-119">For example, an application may request a particular service by calling *nx_mdns_service_one_shot_query.*</span></span> <span data-ttu-id="250ef-120">Jeśli usługa nie zostanie znaleziona w pamięci podręcznej usługi peer, usługa mDNS tworzy pytania dotyczące zapytań (PTR, SRV i TXT) w pamięci podręcznej usługi równorzędnej.</span><span class="sxs-lookup"><span data-stu-id="250ef-120">If the service is not found in the peer service cache, mDNS creates query questions (PTR, SRV, and TXT) in the peer service cache.</span></span> <span data-ttu-id="250ef-121">Te pytania dotyczące zapytań będą wysyłane do sieci okresowo aż do momentu rozwiązania usługi lub przeprowadzenia limitu czasu. Podobnie aplikacja może używać interfejsu API *nx_mdns_service_continous_query ()* , aby zażądać określonej usługi przez długi czas (aplikacja anuluje wcześniej wystawione ciągłe zapytanie przy użyciu interfejsu API *nx_mdns_service_query_stop ()* ).</span><span class="sxs-lookup"><span data-stu-id="250ef-121">These query questions will be sent to the network periodically till the service is resolved, or times out. Similar, the application may use the API *nx_mdns_service_continous_query()* to request a particular service over a long period of time (application cancels a previously issued continuous query by using the API *nx_mdns_service_query_stop()* ).</span></span> <span data-ttu-id="250ef-122">Aby wyszukać określoną usługę w pamięci podręcznej usługi równorzędnej bez wysyłania zapytań do sieci, aplikacje mogą używać interfejsu API *nx_mdns_serivce_lookup ().*</span><span class="sxs-lookup"><span data-stu-id="250ef-122">To search for a particular service in the peer service cache without sending queries to the network, applications can use the API *nx_mdns_serivce_lookup().*</span></span> <span data-ttu-id="250ef-123">Ten interfejs API przeszukuje rekordy zasobów tylko w pamięci podręcznej usługi równorzędnej.</span><span class="sxs-lookup"><span data-stu-id="250ef-123">This API only searches the resource records in the peer service cache.</span></span>

<span data-ttu-id="250ef-124">Każdy rekord zasobu jest przechowywany w strukturze danych *NX_MDNS_RR* w pamięci podręcznej usługi.</span><span class="sxs-lookup"><span data-stu-id="250ef-124">Each Resource Record is stored in a data structure *NX_MDNS_RR* in the service caches.</span></span> <span data-ttu-id="250ef-125">Ciągi w rekordach zasobów są o zmiennej długości, dlatego nie są przechowywane w strukturze *NX_MDNS_RR* .</span><span class="sxs-lookup"><span data-stu-id="250ef-125">Strings in Resource Records are variable length, therefore are not stored in the *NX_MDNS_RR* structure.</span></span> <span data-ttu-id="250ef-126">Rekord zasobu zawiera wskaźnik do rzeczywistej lokalizacji pamięci, w której jest przechowywany ciąg.</span><span class="sxs-lookup"><span data-stu-id="250ef-126">The Resource Record contains a pointer to the actual memory location where the string is stored.</span></span> <span data-ttu-id="250ef-127">Tabela ciągów i rekordy zasobów współużytkują pamięć podręczną usługi.</span><span class="sxs-lookup"><span data-stu-id="250ef-127">The string table and the Resource Records share the service cache.</span></span> <span data-ttu-id="250ef-128">Rekordy zasobów są przechowywane od początku pamięci podręcznej usługi i rosną do końca pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="250ef-128">Resource Records are stored from the beginning of the service cache, and grow towards the end of the cache.</span></span> <span data-ttu-id="250ef-129">Tabela ciągów rozpoczyna się od końca pamięci podręcznej usługi i powiększa się do początku pamięci podręcznej.</span><span class="sxs-lookup"><span data-stu-id="250ef-129">The string table starts from the end of the service cache and grows towards the beginning of the cache.</span></span> <span data-ttu-id="250ef-130">Każdy ciąg w tabeli ciągów ma pole długości i pole licznika.</span><span class="sxs-lookup"><span data-stu-id="250ef-130">Each string in the string table has a length field and a counter field.</span></span> <span data-ttu-id="250ef-131">Gdy ciąg zostanie dodany do tabeli ciągów, jeśli ten sam ciąg już występuje w tabeli, wartość licznika jest zwiększana i nie jest przydzielono żadnej pamięci dla ciągu.</span><span class="sxs-lookup"><span data-stu-id="250ef-131">When a string is added to the string table, if the same string is already present in the table, the counter value is incremented and no memory is allocated for the string.</span></span> <span data-ttu-id="250ef-132">Pamięć podręczna usługi jest traktowana jako pełna, jeśli do pamięci podręcznej usługi nie można dodać więcej rekordów zasobów lub nowych ciągów.</span><span class="sxs-lookup"><span data-stu-id="250ef-132">The service cache is considered full if no more resource records or new strings can be added to the service cache.</span></span>

<span data-ttu-id="250ef-133">Istnieją dwa sposoby na znalezienie usług oferowanych w sieci lokalnej przez aplikację.</span><span class="sxs-lookup"><span data-stu-id="250ef-133">There are two ways for an application to find services offered on the local network.</span></span> <span data-ttu-id="250ef-134">Może wystawić konkretną usługę wyszukaną w ramach zapytania z jednym zdjęciem lub może zainicjować ciągłe zapytanie w celu "monitorowania" działań w sieci.</span><span class="sxs-lookup"><span data-stu-id="250ef-134">It can either issue a specific service look up through a one-shot query, or it can initiate a continuous query to “monitor” the activities on the network.</span></span> <span data-ttu-id="250ef-135">W scenariuszu z jedną krótką kwerendą aplikacja musi określić typ usługi.</span><span class="sxs-lookup"><span data-stu-id="250ef-135">In the one-short query scenario, the application must specify the service type.</span></span> <span data-ttu-id="250ef-136">Usługa mDNS wyszukuje za pomocą lokalnej pamięci podręcznej usługi i równorzędnej pamięci podręcznej usługi.</span><span class="sxs-lookup"><span data-stu-id="250ef-136">mDNS searches through the local service cache and the peer service cache.</span></span> <span data-ttu-id="250ef-137">W przypadku zlokalizowania wystąpień usługi zapytanie z jednym zdjęciem zwraca z informacjami znajdującymi się w rekordach zasobów.</span><span class="sxs-lookup"><span data-stu-id="250ef-137">If a service instances is located, the one-shot query returns with the information found in the Resource Records.</span></span> <span data-ttu-id="250ef-138">Jeśli w pamięci podręcznej usługi lokalnej lub w pamięci podręcznej usługi sieci równorzędnej nie ma żadnych rekordów, usługa mDNS wysyła komunikaty zapytań.</span><span class="sxs-lookup"><span data-stu-id="250ef-138">If there are no records in the local service cache or peer service cache, mDNS sends out query messages.</span></span> <span data-ttu-id="250ef-139">Jeśli nazwa wystąpienia jest określona, *dowolnego* typu (kwerenda typu SRV i txt) o określonej nazwie wystąpienia w postaci "name. Type. local" jest wysyłana do sieci lokalnej.</span><span class="sxs-lookup"><span data-stu-id="250ef-139">If the instance name is specified, an *ANY* type (query the SRV and TXT type) with the specific instance name, in the form of “name.type.local”, is sent to the local network.</span></span> <span data-ttu-id="250ef-140">Jeśli nazwa wystąpienia nie zostanie określona, typ PTR zapytania jest wysyłany do sieci lokalnej.</span><span class="sxs-lookup"><span data-stu-id="250ef-140">If the instance name is not specified, a PTR type of query is sent to the local network.</span></span> <span data-ttu-id="250ef-141">Pierwsza odebrana usługa została zwrócona do obiektu wywołującego.</span><span class="sxs-lookup"><span data-stu-id="250ef-141">The first complete service received is returned to the caller.</span></span>

<span data-ttu-id="250ef-142">Ciągłe zapytanie działa inaczej.</span><span class="sxs-lookup"><span data-stu-id="250ef-142">Continuous query works differently.</span></span> <span data-ttu-id="250ef-143">Typowy przypadek użycia dla ciągłego zapytania polega na monitorowaniu sieci lokalnej dla określonej usługi (na przykład w celu ciągłego wyszukiwania usług drukowania w sieci lokalnej).</span><span class="sxs-lookup"><span data-stu-id="250ef-143">The typical use case for a continuous query is to monitor the local network for a specific service (for example to constantly look for printing services on the local network).</span></span> <span data-ttu-id="250ef-144">W takim przypadku aplikacja wystawia zapytanie wyszukiwania (za pośrednictwem zapytania API *nx_mdns_service_continious_*) dla niektórych typów usług.</span><span class="sxs-lookup"><span data-stu-id="250ef-144">In this case the application issues a search query (via the API *nx_mdns_service_continious_* query) for certain type of services.</span></span> <span data-ttu-id="250ef-145">Obiekt wywołujący zazwyczaj nie czeka na określoną odpowiedź.</span><span class="sxs-lookup"><span data-stu-id="250ef-145">The caller typically does not wait for a particular response.</span></span> <span data-ttu-id="250ef-146">W przypadku zapytań przesyłanych w postaci ciągłego zapytania moduł mDNS przesyła zapytania okresowo przy użyciu wykładniczego wzrostu interwałów.</span><span class="sxs-lookup"><span data-stu-id="250ef-146">For queries submitted as continuous query, the mDNS module transmits the queries periodically with exponentially increasing intervals.</span></span> <span data-ttu-id="250ef-147">Aby zatrzymać zapytanie, aplikacja musi używać interfejsu API *nx_mdns_service_query_stop* , aby zatrzymać wewnętrzny czasomierz w tych zapytaniach.</span><span class="sxs-lookup"><span data-stu-id="250ef-147">To stop the query, application must use the API *nx_mdns_service_query_stop* to stop the internal timer in these queries.</span></span> <span data-ttu-id="250ef-148">Typ zapytania może mieć wartość NULL. w takim przypadku typ zapytania jest ustawiony na specjalny typ PTR "_services. _DNS-SD. _udp. local".</span><span class="sxs-lookup"><span data-stu-id="250ef-148">The query type can be NULL, in which case the query type is set to special PTR type “_services._dns-sd._udp.local”.</span></span> <span data-ttu-id="250ef-149">Ten typ usługi jest definiowany przez mDNS jako sposób odnajdowania wszystkich usług dostępnych w sieci lokalnej.</span><span class="sxs-lookup"><span data-stu-id="250ef-149">This service type is defined by mDNS as a way to discover all services available on the local network.</span></span> <span data-ttu-id="250ef-150">Jeśli zostanie podana nazwa wystąpienia, dowolny typ (zapytanie o typ SRV i TXT) o określonej nazwie wystąpienia "name. Type. local" jest wysyłany do sieci lokalnej.</span><span class="sxs-lookup"><span data-stu-id="250ef-150">If the instance name is supplied, an ANY type (query the SRV and TXT type) with the specific instance name “name.type.local” is sent to the local network.</span></span> <span data-ttu-id="250ef-151">Jeśli nazwa wystąpienia ma wartość NULL, typ PTR zapytania jest wysyłany do sieci lokalnej,</span><span class="sxs-lookup"><span data-stu-id="250ef-151">If the instance name is NULL, a PTR type of query is sent to the local network,</span></span>

<span data-ttu-id="250ef-152">Wszystkie odpowiedzi, w tym odpowiedzi z niezamówionych zapytań, są rejestrowane w pamięci podręcznej usługi równorzędnej.</span><span class="sxs-lookup"><span data-stu-id="250ef-152">All responses, including responses from unsolicited queries, are recorded in the peer service cache.</span></span> <span data-ttu-id="250ef-153">W późniejszym czasie aplikacja używa interfejsu API *nx_mdns_service_lookup* do pobierania określonej usługi z pamięci podręcznej usługi równorzędnej.</span><span class="sxs-lookup"><span data-stu-id="250ef-153">At a later time, the application uses the API *nx_mdns_service_lookup* to retrieve specific service from the peer service cache.</span></span>

<span data-ttu-id="250ef-154">Specjalna Uwaga dotycząca fragmentacji: Każda struktura *NX_MDNS_RR* ma ustalony rozmiar i w związku z tym nie podlega fragmentacji, ponieważ program mDNS dodaje i usuwa rekordy zasobów.</span><span class="sxs-lookup"><span data-stu-id="250ef-154">Special note on fragmentation: Each *NX_MDNS_RR* structure is fixed in size, and therefore is not subject to fragmentation as mDNS adds and deletes RRs.</span></span> <span data-ttu-id="250ef-155">Ciągi są jednak o zmiennej długości.</span><span class="sxs-lookup"><span data-stu-id="250ef-155">However strings are variable length.</span></span> <span data-ttu-id="250ef-156">Po usunięciu ciągu miejsce stanie się dostępne i może być używane dla nowego ciągu, jeśli nowy ciąg może się zmieścić w.</span><span class="sxs-lookup"><span data-stu-id="250ef-156">After a string is deleted, the space becomes available and could be used for a new string if the new string is able to fit in.</span></span> <span data-ttu-id="250ef-157">Jednak ta operacja powoduje fragmentację pamięci.</span><span class="sxs-lookup"><span data-stu-id="250ef-157">But this operation causes the memory to fragment.</span></span> <span data-ttu-id="250ef-158">Po dodaniu i usunięciu usług tabela ciągów może być pofragmentowana do punktu, w którym nie można dodać nowych ciągów, nawet jeśli pamięć podręczna usługi zawiera wystarczającą liczbę nieużywanych bajtów dla tego ciągu.</span><span class="sxs-lookup"><span data-stu-id="250ef-158">As services are added and removed, the string table may be fragmented to the point that no new strings can be added even though the service cache contains enough unused bytes for the string.</span></span> <span data-ttu-id="250ef-159">Aplikacje lokalne są bardziej stabilne i przewidywalne.</span><span class="sxs-lookup"><span data-stu-id="250ef-159">Local applications tend to be more stable and predictable.</span></span> <span data-ttu-id="250ef-160">W związku z tym pamięć podręczna usługi lokalnej może być mniej istotna od fragmentacji.</span><span class="sxs-lookup"><span data-stu-id="250ef-160">Therefore the local service cache is less likely to suffer from fragmentation.</span></span> <span data-ttu-id="250ef-161">Pamięć podręczna usługi równorzędnej, z drugiej strony, ciągle dodaje rekordy zasobów, ponieważ usługi staną się dostępne, lub usuń rekordy zasobów, gdy usługi są usuwane przez węzły w sieci.</span><span class="sxs-lookup"><span data-stu-id="250ef-161">The peer service cache, on the other hand, constantly add RRs as the services become available, or remove RRs as services are deleted by the nodes on the network.</span></span> <span data-ttu-id="250ef-162">Usługi w sieci są gotowe do użycia, co powoduje częstsze wykonywanie operacji przydzielania/usuwania w tabeli ciągów.</span><span class="sxs-lookup"><span data-stu-id="250ef-162">Services on the network come and go, causing more frequent allocate/delete operations on the string table.</span></span> <span data-ttu-id="250ef-163">W miarę możliwości tabela ciągów zostanie pofragmentowana.</span><span class="sxs-lookup"><span data-stu-id="250ef-163">Over time it is possible the string table becomes fragmented.</span></span> <span data-ttu-id="250ef-164">W takiej sytuacji proste rozwiązanie to opróżnianie całej pamięci podręcznej usługi peer Service.</span><span class="sxs-lookup"><span data-stu-id="250ef-164">When this situation happens, a simple solution is to flush the entire peer service cache.</span></span> <span data-ttu-id="250ef-165">Można to zrobić, wywołując interfejs API *nx_mdns_peer_cache_clear ().*</span><span class="sxs-lookup"><span data-stu-id="250ef-165">This can be done by calling the API *nx_mdns_peer_cache_clear().*</span></span> <span data-ttu-id="250ef-166">Należy zauważyć, że ten interfejs API automatycznie kończy wszystkie zaległe zapytania ciągłe.</span><span class="sxs-lookup"><span data-stu-id="250ef-166">Note that this API automatically terminates any outstanding continuous queries.</span></span>
