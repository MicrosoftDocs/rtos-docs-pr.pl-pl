---
title: Rozdział 1 — wprowadzenie do usługi Azure RTO NetX Duo SNTP
description: Usługa Azure RTO NetX Simple Network Time Protocol (SNTP) to protokół służący do synchronizowania zegarów przez Internet.
author: philmea
ms.author: philmea
ms.date: 06/04/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: b3e1170197c6c4981060459104da80e354fac5db
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/22/2021
ms.locfileid: "104821655"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-sntp"></a><span data-ttu-id="b75b1-103">Rozdział 1 — wprowadzenie do usługi Azure RTO NetX Duo SNTP</span><span class="sxs-lookup"><span data-stu-id="b75b1-103">Chapter 1 - Introduction to Azure RTOS NetX Duo SNTP</span></span> 

<span data-ttu-id="b75b1-104">Usługa Azure RTO NetX Simple Network Time Protocol (SNTP) to protokół służący do synchronizowania zegarów przez Internet.</span><span class="sxs-lookup"><span data-stu-id="b75b1-104">The Azure RTOS NetX Simple Network Time Protocol (SNTP) is a protocol designed for synchronizing clocks over the Internet.</span></span> <span data-ttu-id="b75b1-105">SNTP w wersji 4 to uproszczony protokół oparty na protokole NTP (Network Time Protocol).</span><span class="sxs-lookup"><span data-stu-id="b75b1-105">SNTP Version 4 is a simplified protocol based on the Network Time Protocol (NTP).</span></span> <span data-ttu-id="b75b1-106">Korzysta ona z usług UDP (User Datagram Protocol) do wykonywania aktualizacji czasowych w prostym, bezstanowym protokole.</span><span class="sxs-lookup"><span data-stu-id="b75b1-106">It utilizes User Datagram Protocol (UDP) services to perform time updates in a simple, stateless protocol.</span></span> <span data-ttu-id="b75b1-107">Chociaż nie jest to skomplikowane jako NTP, SNTP jest wysoce niezawodny i dokładny.</span><span class="sxs-lookup"><span data-stu-id="b75b1-107">Though not as complex as NTP, SNTP is highly reliable and accurate.</span></span> <span data-ttu-id="b75b1-108">W większości miejsc Internetu dzisiaj protokół SNTP zapewnia dokładności 1-50 milisekund, w zależności od właściwości źródła synchronizacji i ścieżki sieci.</span><span class="sxs-lookup"><span data-stu-id="b75b1-108">In most places of the Internet of today, SNTP provides accuracies of 1-50 milliseconds, depending on the characteristics of the synchronization source and network paths.</span></span> <span data-ttu-id="b75b1-109">Protokół SNTP ma wiele opcji zapewniających niezawodność aktualizacji czasu do odebrania.</span><span class="sxs-lookup"><span data-stu-id="b75b1-109">SNTP has many options to provide reliability of receiving time updates.</span></span> <span data-ttu-id="b75b1-110">Możliwość przełączania do alternatywnych serwerów, stosowania algorytmów sondowania i automatycznego odnajdywania serwera, to tylko kilka z metod obsługi przez klienta SNTP zmiennej internetowego środowiska usługi czasowej.</span><span class="sxs-lookup"><span data-stu-id="b75b1-110">Ability to switch to alternative servers, applying back off polling algorithms and automatic time server discovery are just a few of the means for an SNTP client to handle a variable Internet time service environment.</span></span> <span data-ttu-id="b75b1-111">To, czego nie ma w tym sensie, stanowi prostotę i łatwość implementacji.</span><span class="sxs-lookup"><span data-stu-id="b75b1-111">What it lacks in precision it makes up for in simplicity and ease of implementation.</span></span> <span data-ttu-id="b75b1-112">Protokół SNTP jest przeznaczony głównie do zapewniania kompleksowych mechanizmów uzyskiwania dostępu do Narodowego czasu i rozpowszechniania (np. serwera NTP) usług.</span><span class="sxs-lookup"><span data-stu-id="b75b1-112">SNTP is intended primarily for providing comprehensive mechanisms to access national time and frequency dissemination (e.g. NTP server) services.</span></span>

## <a name="netx-duo-sntp-client-requirements"></a><span data-ttu-id="b75b1-113">Wymagania dotyczące klienta SNTP NetX Duo</span><span class="sxs-lookup"><span data-stu-id="b75b1-113">NetX Duo SNTP Client Requirements</span></span>

<span data-ttu-id="b75b1-114">Klient SNTP NetX Duo wymaga, aby wystąpienie adresu IP zostało już utworzone.</span><span class="sxs-lookup"><span data-stu-id="b75b1-114">The NetX Duo SNTP Client requires that an IP instance has already been created.</span></span> <span data-ttu-id="b75b1-115">Ponadto protokół UDP musi być włączony w tym samym wystąpieniu IP i powinien mieć dostęp do *dobrze znanego* portu 123 na potrzeby wysyłania danych czasu do serwera SNTP, chociaż alternatywne porty również będą działać.</span><span class="sxs-lookup"><span data-stu-id="b75b1-115">In addition, UDP must be enabled on that same IP instance and should have access to the *well-known* port 123 for sending time data to an SNTP Server, although alternative ports will work as well.</span></span> <span data-ttu-id="b75b1-116">Klienci emisji powinni powiązać z portem UDP, na którym jest wysyłany serwer emisji, zwykle 123.</span><span class="sxs-lookup"><span data-stu-id="b75b1-116">Broadcast clients should bind the UDP port their broadcast server is sending on, usually 123.</span></span> <span data-ttu-id="b75b1-117">Aplikacja kliencka NetX Duo SNTP musi mieć jeden lub więcej adresów IP protokołu SNTP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-117">The NetX Duo SNTP Client application must have one or more IP SNTP Server addresses.</span></span>

## <a name="netx-duo-sntp-client-limitations"></a><span data-ttu-id="b75b1-118">Ograniczenia klienta SNTP NetX Duo</span><span class="sxs-lookup"><span data-stu-id="b75b1-118">NetX Duo SNTP Client Limitations</span></span> 

<span data-ttu-id="b75b1-119">Precyzja w czasie lokalnym reprezentacji w czasie NTP aktualizacje obsługiwane przez interfejs API klienta protokołu SNTP jest ograniczone do liczby milisekund.</span><span class="sxs-lookup"><span data-stu-id="b75b1-119">Precision in local time representation in NTP time updates handled by the SNTP Client API is limited to millisecond resolution.</span></span>

<span data-ttu-id="b75b1-120">Klient SNTP przechowuje tylko jeden adres serwera SNTP w dowolnym momencie.</span><span class="sxs-lookup"><span data-stu-id="b75b1-120">The SNTP Client only holds a single SNTP Server address at any time.</span></span> <span data-ttu-id="b75b1-121">Jeśli ten serwer prawdopodobnie nie jest już prawidłowy, aplikacja musi zatrzymać zadanie klienta SNTP i zainicjować je ponownie z innym adresem serwera SNTP przy użyciu emisji lub protokołu SNTP emisji pojedynczej.</span><span class="sxs-lookup"><span data-stu-id="b75b1-121">If that Server appears to be no longer valid, the application must stop the SNTP Client task, and reinitialize it with another SNTP server address, using either broadcast or unicast SNTP communication.</span></span>

<span data-ttu-id="b75b1-122">Klient SNTP nie obsługuje manycast.</span><span class="sxs-lookup"><span data-stu-id="b75b1-122">The SNTP Client does not support manycast.</span></span>

<span data-ttu-id="b75b1-123">Klient SNTP NetX Duo nie obsługuje mechanizmów uwierzytelniania na potrzeby weryfikowania odebranych danych pakietu.</span><span class="sxs-lookup"><span data-stu-id="b75b1-123">NetX Duo SNTP Client does not support authentication mechanisms for verifying received packet data.</span></span>

## <a name="netx-duo-sntp-client-operation"></a><span data-ttu-id="b75b1-124">Operacja klienta SNTP NetX Duo</span><span class="sxs-lookup"><span data-stu-id="b75b1-124">NetX Duo SNTP Client Operation</span></span>

<span data-ttu-id="b75b1-125">W dokumencie RFC 4330 zaleca się, aby klienci protokołu SNTP mogli działać tylko w najwyższej warstwie sieci lokalnej i najlepiej w konfiguracjach, w których żaden klient NTP lub SNTP nie jest zależny od nich do synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="b75b1-125">RFC 4330 recommends that SNTP clients should operate only at the highest stratum of their local network and preferably in configurations where no NTP or SNTP client is dependent them for synchronization.</span></span> <span data-ttu-id="b75b1-126">Poziom warstwy odzwierciedla pozycję hosta w hierarchii czasu NTP, w której warstwa 1 to najwyższy poziom (główny serwer czasu), a 15 to najniższy dozwolony poziom (np. Klient).</span><span class="sxs-lookup"><span data-stu-id="b75b1-126">Stratum level reflects the host position in the NTP time hierarchy where stratum 1 is the highest level (a root time server) and 15 is the lowest allowed level (e.g. Client).</span></span> <span data-ttu-id="b75b1-127">Domyślna minimalna warstwa klienta SNTP to 2.</span><span class="sxs-lookup"><span data-stu-id="b75b1-127">The SNTP Client default minimum stratum is 2.</span></span>

<span data-ttu-id="b75b1-128">Klient SNTP NetX Duo może działać w jednym z dwóch podstawowych trybów, emisji pojedynczej lub emisji, aby uzyskać czas za pośrednictwem Internetu.</span><span class="sxs-lookup"><span data-stu-id="b75b1-128">The NetX Duo SNTP Client can operate in one of two basic modes, unicast or broadcast, to obtain time over the Internet.</span></span> <span data-ttu-id="b75b1-129">W trybie emisji pojedynczej klient sonduje swój serwer SNTP w regularnych odstępach czasu i czeka na odebranie odpowiedzi z tego serwera.</span><span class="sxs-lookup"><span data-stu-id="b75b1-129">In unicast mode, the Client polls its SNTP Server on regular intervals and waits to receive a reply from that Server.</span></span> <span data-ttu-id="b75b1-130">Po odebraniu klient sprawdza, czy odpowiedź zawiera prawidłową aktualizację czasu, stosując zestaw "Sanity checks" zalecanego w dokumencie RFC 4330.</span><span class="sxs-lookup"><span data-stu-id="b75b1-130">When one is received, the Client verifies that the reply contains a valid time update by applying a set of ‘sanity checks’ recommended by RFC 4330.</span></span> <span data-ttu-id="b75b1-131">Następnie klient stosuje różnicę czasu, jeśli istnieje, z zegarem serwera do zegara lokalnego.</span><span class="sxs-lookup"><span data-stu-id="b75b1-131">The Client then applies the time difference, if any, with the Server clock to its local clock.</span></span> <span data-ttu-id="b75b1-132">W trybie emisji klient tylko nasłuchuje emisji aktualizacji czasu i utrzymuje zegar lokalny po zastosowaniu podobnego zestawu Sanity checks w celu zweryfikowania danych dotyczących czasu aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="b75b1-132">In broadcast mode, the Client merely listens for time update broadcasts and maintains its local clock after applying a similar set of sanity checks to verify the update time data.</span></span> <span data-ttu-id="b75b1-133">Sanity checks są szczegółowo opisane w poniższej sekcji **checks w usłudze SNTP Sanity** .</span><span class="sxs-lookup"><span data-stu-id="b75b1-133">Sanity checks are described in detail in the **SNTP Sanity Checks** section below.</span></span>

<span data-ttu-id="b75b1-134">Przed uruchomieniem klienta w obu trybach należy określić jego parametry operacyjne.</span><span class="sxs-lookup"><span data-stu-id="b75b1-134">Before the Client can run in either mode, it must establish its operating parameters.</span></span> <span data-ttu-id="b75b1-135">Jest to realizowane przez wywołanie odpowiednio *nx_sntp_client_initialize_unicast* lub *nx_sntp_client_initialize_broadcast* dla trybów emisji pojedynczej lub emisji.</span><span class="sxs-lookup"><span data-stu-id="b75b1-135">This is done by calling either *nx_sntp_client_initialize_unicast* or *nx_sntp_client_initialize_broadcast* for unicast or broadcast modes, respectively.</span></span> <span data-ttu-id="b75b1-136">Służą one do ustawiania przedziałów czasowych dla maksymalnego czasu, który upłynął, bez prawidłowej aktualizacji, odebrano limit kolejnych nieprawidłowych aktualizacji, interwału sondowania trybu emisji pojedynczej, trybu operacji, np. emisji pojedynczej i emisji oraz serwera SNTP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-136">These serves set the time outs for maximum time lapse without a valid update, the limit on consecutive invalid updates received, a polling interval for unicast mode, operation mode e.g. unicast vs. broadcast, and SNTP Server.</span></span>

<span data-ttu-id="b75b1-137">W przypadku przekroczenia maksymalnego czasu wygaśnięcia lub maksymalnej liczby odebranych nieprawidłowych aktualizacji klient SNTP będzie kontynuował pracę, ale ustawia bieżący stan serwera SNTP na nieprawidłowy.</span><span class="sxs-lookup"><span data-stu-id="b75b1-137">If the maximum time lapse or maximum invalid updates received is exceeded, the SNTP Client continues to run but sets the current SNTP Server status to invalid.</span></span> <span data-ttu-id="b75b1-138">Aplikacja może sondować klienta SNTP przy użyciu usługi *nx_sntp_client_receiving_updates* , aby sprawdzić, czy serwer SNTP nadal wysyła prawidłowe aktualizacje.</span><span class="sxs-lookup"><span data-stu-id="b75b1-138">The application can poll the SNTP Client using the *nx_sntp_client_receiving_updates* service to verify the SNTP Server is still sending valid updates.</span></span> <span data-ttu-id="b75b1-139">W przeciwnym razie należy zatrzymać wątek klienta SNTP przy użyciu usługi *nx_sntp_client_stop* i wywołać jedną z dwóch inicjowanych usług, aby ustawić inny adres serwera SNTP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-139">If not, it should stop the SNTP Client thread using the *nx_sntp_client_stop* service and call either of the two initialize services to set another SNTP Server address.</span></span> <span data-ttu-id="b75b1-140">Aby ponownie uruchomić klienta SNTP, aplikacja wywołuje *nx_sntp_client_run_broadcast* lub *nx_sntp_client_run_unicast*.</span><span class="sxs-lookup"><span data-stu-id="b75b1-140">To restart the SNTP Client, the application calls *nx_sntp_client_run_broadcast* or *nx_sntp_client_run_unicast*.</span></span> <span data-ttu-id="b75b1-141">Należy pamiętać, że aplikacja może zmienić tryb operacyjny klienta SNTP w wywołaniu inicjowania, aby przełączyć się na emisję pojedynczą lub emisję zgodnie z potrzebami.</span><span class="sxs-lookup"><span data-stu-id="b75b1-141">Note that the application can change SNTP Client operating mode in the initialize call to switch to unicast or broadcast as desired.</span></span>

### <a name="local-clock-operation"></a><span data-ttu-id="b75b1-142">Operacja zegara lokalnego</span><span class="sxs-lookup"><span data-stu-id="b75b1-142">Local Clock Operation</span></span>

<span data-ttu-id="b75b1-143">Czas SNTP na podstawie liczby sekund w ciągu głównego zegara NTP lub liczby sekund, które upłynęły od pierwszej epoki NTP, np. od 1 stycznia **1900 00:00:00 do** 1 stycznia **1999 00:00:00**.</span><span class="sxs-lookup"><span data-stu-id="b75b1-143">The SNTP time based on the number of seconds on the master NTP clock, or number of seconds elapsed in the first NTP epoch e.g. from Jan 1 **1900 00:00:00 to** Jan 1 **1999 00:00:00**.</span></span> <span data-ttu-id="b75b1-144">Istotność 01-01-1999 była ostatnią przestępnością sekundy.</span><span class="sxs-lookup"><span data-stu-id="b75b1-144">The significance of 01-01-1999 was when the last leap second occurred.</span></span> <span data-ttu-id="b75b1-145">Ta wartość jest definiowana w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="b75b1-145">This value is defined as follows:</span></span>

<span data-ttu-id="b75b1-146">\#Zdefiniuj NTP_SECONDS_AT_01011999 0xBA368E80</span><span class="sxs-lookup"><span data-stu-id="b75b1-146">\#define NTP_SECONDS_AT_01011999 0xBA368E80</span></span>

<span data-ttu-id="b75b1-147">Przed uruchomieniem klienta SNTP aplikacja może opcjonalnie zainicjować czas lokalny klienta SNTP, który będzie używany przez klienta jako czas podstawowy.</span><span class="sxs-lookup"><span data-stu-id="b75b1-147">Before the SNTP Client runs, the application can optionally initialize the SNTP Client local time for the Client to use as a baseline time.</span></span> <span data-ttu-id="b75b1-148">W tym celu należy użyć usługi *nx_sntp_client_set_local_time* .</span><span class="sxs-lookup"><span data-stu-id="b75b1-148">To do so, it must use the *nx_sntp_client_set_local_time* service.</span></span> <span data-ttu-id="b75b1-149">Trwa to czas w formacie NTP, sekundy i ułamek, gdzie ułamek jest milisekundą w czasie trwania NTP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-149">This takes the time in NTP format, seconds and fraction, where fraction is the milliseconds in the NTP condensed time.</span></span> <span data-ttu-id="b75b1-150">Najlepiej, aby aplikacja mogła uzyskać czas SNTP z niezależnego źródła.</span><span class="sxs-lookup"><span data-stu-id="b75b1-150">Ideally the application can obtain an SNTP time from an independent source.</span></span> <span data-ttu-id="b75b1-151">Nie istnieje interfejs API służący do konwertowania roku, miesiąca, daty i czasu na czas NTP w kliencie NetX Duo SNTP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-151">There is no API for converting year, month, date and time to an NTP time in the NetX Duo SNTP Client.</span></span> <span data-ttu-id="b75b1-152">Opis formatu czasu NTP można znaleźć w *RFC4330 "Simple Network Time Protocol (SNTP) w wersji 4 dla protokołów IPv4, IPv6 i osi".*</span><span class="sxs-lookup"><span data-stu-id="b75b1-152">For a description of NTP time format, refer to *RFC4330 “Simple Network Time Protocol (SNTP) Version 4 for IPv4, IPv6 and OSI”.*</span></span>

<span data-ttu-id="b75b1-153">Jeśli podczas uruchamiania klienta SNTP nie podano podstawowego czasu lokalnego, klient SNTP zaakceptuje aktualizacje SNTP bez porównywania ich z lokalnym czasem przy pierwszej aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="b75b1-153">If no base local time is supplied when the SNTP Client starts up, the SNTP Client will accept the SNTP updates without comparing to its local time on the first update.</span></span> <span data-ttu-id="b75b1-154">Następnie użyje wartości maksymalnego i minimalnego czasu aktualizacji, aby określić, czy będzie on modyfikowany jako czas lokalny.</span><span class="sxs-lookup"><span data-stu-id="b75b1-154">Thereafter it will apply the maximum and minimum time update values to determine if it will modify its local time.</span></span>

<span data-ttu-id="b75b1-155">Aby uzyskać czas lokalny klienta SNTP, aplikacja może używać usługi *nx_sntp_client_get_local_time_extended* .</span><span class="sxs-lookup"><span data-stu-id="b75b1-155">To obtain the SNTP Client local time, the application can use the *nx_sntp_client_get_local_time_extended* service.</span></span>

### <a name="sntp-sanity-checks"></a><span data-ttu-id="b75b1-156">Kontrole Sanity SNTP</span><span class="sxs-lookup"><span data-stu-id="b75b1-156">SNTP Sanity Checks</span></span> 

<span data-ttu-id="b75b1-157">Klient analizuje pakiet przychodzący dla następujących kryteriów:</span><span class="sxs-lookup"><span data-stu-id="b75b1-157">The Client examines the incoming packet for the following criteria:</span></span>

  - <span data-ttu-id="b75b1-158">Źródłowy adres IP musi być zgodny z bieżącym adresem IP serwera.</span><span class="sxs-lookup"><span data-stu-id="b75b1-158">Source IP address must match the current server IP address.</span></span>

  - <span data-ttu-id="b75b1-159">Port źródłowy nadawcy musi być zgodny z bieżącym portem źródłowym serwera.</span><span class="sxs-lookup"><span data-stu-id="b75b1-159">Sender source port must match with the current server source port.</span></span>

  - <span data-ttu-id="b75b1-160">Długość pakietu musi być minimalna długość, aby można było przechowywać komunikat czasu SNTP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-160">Packet length must be the minimum length to hold an SNTP time message.</span></span>

<span data-ttu-id="b75b1-161">Następnie dane czasu są wyodrębniane z bufora pakietów, do którego Klient zastosuje zestaw konkretnych Sanity checks:</span><span class="sxs-lookup"><span data-stu-id="b75b1-161">Next, the time data is extracted from the packet buffer to which the Client then applies a set of specific ‘sanity checks’:</span></span>

  - <span data-ttu-id="b75b1-162">Wskaźnik przestępny ustawiony na 3 wskazuje, że serwer nie jest zsynchronizowany.</span><span class="sxs-lookup"><span data-stu-id="b75b1-162">The Leap Indicator set to 3 indicates the Server is not synchronized.</span></span> <span data-ttu-id="b75b1-163">Klient powinien próbować znaleźć alternatywny serwer.</span><span class="sxs-lookup"><span data-stu-id="b75b1-163">The Client should attempt to find an alternative server.</span></span>

  - <span data-ttu-id="b75b1-164">Pole warstwy o wartości zero jest znane jako odnosi pakiet zgonu (KOD).</span><span class="sxs-lookup"><span data-stu-id="b75b1-164">A stratum field set to zero is known as a Kiss of Death (KOD) packet.</span></span> <span data-ttu-id="b75b1-165">Program obsługi kodu klienta SMTP w tej sytuacji jest wywołaniem zwrotnym zdefiniowanym przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="b75b1-165">The SMTP Client KOD handler for this situation is a user defined callback.</span></span> <span data-ttu-id="b75b1-166">Mały przykładowy plik demonstracyjny zawiera prostą procedurę obsługi kodu dla tej sytuacji.</span><span class="sxs-lookup"><span data-stu-id="b75b1-166">The small example demo file contains a simple KOD handler for this situation.</span></span> <span data-ttu-id="b75b1-167">Pole Identyfikator odwołania opcjonalnie zawiera kod wskazujący powód odpowiedzi na KOD.</span><span class="sxs-lookup"><span data-stu-id="b75b1-167">The Reference ID field optionally contains a code indicating the reason for the KOD reply.</span></span> <span data-ttu-id="b75b1-168">W dowolnym tempie procedura obsługi kodu musi wskazywać, jak obsługiwać odbiór śmierci z serwera SNTP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-168">At any rate, the KOD handler must indicate how to handle receiving a kiss of death from the SNTP Server.</span></span> <span data-ttu-id="b75b1-169">Zazwyczaj należy ponownie zainicjować klienta SNTP przy użyciu innego serwera SNTP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-169">Typically it will want to reinitialize the SNTP Client with another SNTP Server.</span></span>

  - <span data-ttu-id="b75b1-170">Wersja, warstwa i tryb operacji SNTP serwera muszą być dopasowane do usługi klienta.</span><span class="sxs-lookup"><span data-stu-id="b75b1-170">The Server SNTP version, stratum and mode of operation must be matched to the Client service.</span></span>

  - <span data-ttu-id="b75b1-171">Jeśli klient został skonfigurowany z maksymalną ilością rozproszenia zegara serwera, klient sprawdza rozproszenie zegara serwera przy pierwszej aktualizacji, która została odebrana, a jeśli przekroczy maksimum klienta, klient odrzuca serwer.</span><span class="sxs-lookup"><span data-stu-id="b75b1-171">If the Client is configured with a server clock dispersion maximum, the Client checks the server clock dispersion on the first update received only, and if it exceeds the Client maximum, the Client rejects the Server.</span></span>

  - <span data-ttu-id="b75b1-172">Pola sygnatury czasowej serwera muszą również przekazywać określone sprawdzenia.</span><span class="sxs-lookup"><span data-stu-id="b75b1-172">The Server time stamp fields must also pass specific checks.</span></span> <span data-ttu-id="b75b1-173">W przypadku serwera emisji pojedynczej wszystkie pola czasu muszą być wypełnione i nie mogą mieć wartości NULL.</span><span class="sxs-lookup"><span data-stu-id="b75b1-173">For the unicast Server, all time fields must be filled in and cannot be NULL.</span></span> <span data-ttu-id="b75b1-174">Sygnatura czasowa punktu początkowego musi być równa sygnatury czasowej transmisji w żądaniu komunikatu czasu SNTP klienta.</span><span class="sxs-lookup"><span data-stu-id="b75b1-174">The Origination time stamp must equal the Transmit time stamp in the Client’s SNTP time message request.</span></span> <span data-ttu-id="b75b1-175">Zapewnia to ochronę klienta przed złośliwymi intruzami i zachowaniem nieautoryzowanego serwera.</span><span class="sxs-lookup"><span data-stu-id="b75b1-175">This protects the Client from malicious intruders and rogue Server behavior.</span></span> <span data-ttu-id="b75b1-176">Serwer emisji musi wypełniać tylko sygnaturę czasową transmisji.</span><span class="sxs-lookup"><span data-stu-id="b75b1-176">The broadcast Server need only fill in the Transmit time stamp.</span></span> <span data-ttu-id="b75b1-177">Ponieważ nie odbiera niczego od klienta, nie ma pól odbioru lub pochodzenia do wypełnienia.</span><span class="sxs-lookup"><span data-stu-id="b75b1-177">Since it does not receive anything from the Client it has no Receive or Origination fields to fill in.</span></span>

    <span data-ttu-id="b75b1-178">Niepowodzenie Sanity Check a Time Update jako nieprawidłową aktualizację czasu.</span><span class="sxs-lookup"><span data-stu-id="b75b1-178">A failed sanity check brands a time update as an invalid time update.</span></span> <span data-ttu-id="b75b1-179">Usługa sprawdzania Sanity klienta SNTP śledzi liczbę kolejnych nieprawidłowych aktualizacji czasu odebranych z tego samego serwera.</span><span class="sxs-lookup"><span data-stu-id="b75b1-179">The SNTP Client sanity check service tracks the number of consecutive invalid time updates received from the same Server.</span></span>

<span data-ttu-id="b75b1-180">Gdy zadanie wątku klienta SNTP sprawdza poprawność pakietu SNTP do zastosowania do lokalnego czasu klienta SNTP, zwiększa liczbę klientów SNTP, która `nx_sntp_client_invalid_time_updates.` zwraca również stan błędu do obiektu wywołującego, ale jest to wszystkie wewnętrzne przetwarzanie, dlatego nie jest natychmiast widoczne dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="b75b1-180">When SNTP Client thread task checks the validity of an SNTP packet for applying to the local SNTP Client time, it increments the count of the SNTP Client `nx_sntp_client_invalid_time_updates.` It also returns an error status to the caller but this is all internal processing so it is not immediately visible to the application.</span></span> <span data-ttu-id="b75b1-181">Sposób wykrywania aktualizacji czasu niepowodzenia polega na wysłaniu zapytania o wartość klienta SNTP `nx_sntp_client_invalid_time_updates` po odebraniu aktualizacji czasu serwera SNTP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-181">The way to detect failed time updates is to query the value of the SNTP Client `nx_sntp_client_invalid_time_updates` after receiving SNTP Server time updates.</span></span>

<span data-ttu-id="b75b1-182">Jeśli aktualizacja czasu serwera przeszedł testy Sanity, klient próbuje przetworzyć dane czasu do czasu lokalnego.</span><span class="sxs-lookup"><span data-stu-id="b75b1-182">If the Server time update passes the sanity checks, the Client then attempts to process the time data to its local time.</span></span> <span data-ttu-id="b75b1-183">Jeśli klient jest skonfigurowany do obliczeń rundy, np. czas wysłania żądania aktualizacji do momentu odebrania, zostanie obliczony czas błądzenia.</span><span class="sxs-lookup"><span data-stu-id="b75b1-183">If the Client is configured for round trip calculation, e.g. the time from sending an update request to the time one is received, the round trip time is calculated.</span></span> <span data-ttu-id="b75b1-184">Ta wartość jest mniejsza, a następnie dodawana do czasu serwera.</span><span class="sxs-lookup"><span data-stu-id="b75b1-184">This value is halved and then added to the Server’s time.</span></span>

<span data-ttu-id="b75b1-185">Następnie, jeśli jest to pierwsza aktualizacja odebrana od bieżącego serwera SNTP, klient SNTP określa, czy powinien on ignorować różnicę między serwerem a lokalnym czasem klienta.</span><span class="sxs-lookup"><span data-stu-id="b75b1-185">Next, if this is the first update received from the current SNTP Server, the SNTP Client determines if it should ignore the difference between the Server and Client local time.</span></span> <span data-ttu-id="b75b1-186">Następnie wszystkie aktualizacje z serwera SNTP są oceniane pod kątem różnic przy użyciu czasu lokalnego klienta.</span><span class="sxs-lookup"><span data-stu-id="b75b1-186">Thereafter all updates from the SNTP Server are evaluated for the difference with the Client local time.</span></span>

<span data-ttu-id="b75b1-187">Różnica między czasem klienta i serwera jest porównywana z `NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT` .</span><span class="sxs-lookup"><span data-stu-id="b75b1-187">The difference between Client and Server time is compared with `NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT`.</span></span> <span data-ttu-id="b75b1-188">W przypadku przekroczenia tej wartości dane są generowane. Różnica jest mniejsza niż `NX_SNTP_CLIENT_MIN_TIME_ADJUSTMENT` mała, aby wymagać korekty.</span><span class="sxs-lookup"><span data-stu-id="b75b1-188">If it exceeds this value, the data is thrown out. If the difference is less than the `NX_SNTP_CLIENT_MIN_TIME_ADJUSTMENT` the difference is considered too small to require adjustment.</span></span>

<span data-ttu-id="b75b1-189">Przekazując wszystkie te sprawdzenia, aktualizacja czasu jest następnie stosowana do klienta SNTP z pewnymi poprawkami dla opóźnień w wewnętrznym przetwarzaniu klienta SNTP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-189">Passing all these checks, the time update is then applied to the SNTP Client with some corrections for delays in internal SNTP Client processing.</span></span>

### <a name="sntp-asynchronous-unicast-requests"></a><span data-ttu-id="b75b1-190">Asynchroniczne żądania emisji pojedynczej SNTP</span><span class="sxs-lookup"><span data-stu-id="b75b1-190">SNTP Asynchronous Unicast Requests</span></span> 

<span data-ttu-id="b75b1-191">Klient SNTP umożliwia aplikacji hosta asynchroniczne wysyłanie żądania emisji pojedynczej do bieżącego czasu z serwera NTP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-191">The SNTP Client allows the host application to asynchronously send a unicast request for the current time from the NTP server.</span></span>

```C
UINT _nx_sntp_client_request_unicast_time(
NX_SNTP_CLIENT *client_ptr, 
UINT wait_option)
```

<span data-ttu-id="b75b1-192">Opcja oczekiwania jest wygaśnięciem oczekiwania na odpowiedź.</span><span class="sxs-lookup"><span data-stu-id="b75b1-192">The wait option is the expiration to wait for a response.</span></span>

<span data-ttu-id="b75b1-193">Jeśli serwer NTP reaguje, pakiet podlega tym samym przetwarzaniem i Sanity sprawdzenia zgodnie z opisem w poprzedniej sekcji przed aktualizacją czasu lokalnego klienta SNTP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-193">If the NTP Server responds, the packet is subjected to the same processing and sanity checks as described in the previous section before updating the SNTP Client local time.</span></span>

<span data-ttu-id="b75b1-194">Jeśli wywołanie zwróci pomyślne zakończenie, aplikacja może wywołać *nx_sntp_client_utility_display_date_time* lub *nx_sntp_client_get_local_time_extended* dla zaktualizowanego czasu lokalnego.</span><span class="sxs-lookup"><span data-stu-id="b75b1-194">If the call returns successful completion, the application can call *nx_sntp_client_utility_display_date_time* or *nx_sntp_client_get_local_time_extended* for the updated local time.</span></span>

<span data-ttu-id="b75b1-195">Te żądania emisji pojedynczej nie zakłócają normalnego harmonogramu klienta protokołu SNTP do wysyłania kolejnego żądania emisji pojedynczej lub w trybie emisji, kiedy oczekiwać następnej emisji NTP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-195">These unicast requests do not interfere with the normal SNTP Client schedule for sending the next unicast request, or if in broadcast mode, when to expect the next NTP broadcast.</span></span>

### <a name="periodic-local-time-updates"></a><span data-ttu-id="b75b1-196">Okresowe aktualizacje czasu lokalnego</span><span class="sxs-lookup"><span data-stu-id="b75b1-196">Periodic Local Time Updates</span></span>

<span data-ttu-id="b75b1-197">Maksymalna korekta czasu lokalnego jest ustawiana w opcji NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT (w milisekundach).</span><span class="sxs-lookup"><span data-stu-id="b75b1-197">The maximum adjustment to the local time is set in the NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT option (in milliseconds).</span></span> <span data-ttu-id="b75b1-198">Interwał aktualizacji sondowania dla operacji klienta SNTP emisji pojedynczej jest ustawiany w opcji NX_SNTP_CLIENT_UNICAST_POLL_INTERVAL (w sekundach).</span><span class="sxs-lookup"><span data-stu-id="b75b1-198">The polling update interval for unicast SNTP Client operations is set in the NX_SNTP_CLIENT_UNICAST_POLL_INTERVAL option (in seconds).</span></span> <span data-ttu-id="b75b1-199">Jeśli wartość interwału sondowania jest większa niż wartość ustawienia maksymalnego, kolejne aktualizacje serwera po pierwszej aktualizacji serwera zostaną odrzucone.</span><span class="sxs-lookup"><span data-stu-id="b75b1-199">If the polling interval is greater than the maximum adjustment, then subsequent server updates after the first server update will be rejected.</span></span> <span data-ttu-id="b75b1-200">Aby tego uniknąć, klient SNTP aktualizuje czas lokalny, który jest definiowany jako NX_SNTP_UPDATE_TIMEOUT_INTERVAL.</span><span class="sxs-lookup"><span data-stu-id="b75b1-200">To prevent this, the SNTP Client will update the local time periodically defined as NX_SNTP_UPDATE_TIMEOUT_INTERVAL.</span></span> 

<span data-ttu-id="b75b1-201">W przypadku różnic w czasie między rejestracją RTC a czasem serwera (w którym czas lokalny klienta SNTP powinien być ustawiony na), czas RTC powinien zostać zsynchronizowany z czasem klienta SNTP (nie jest to zademonstrowane w tym przewodniku użytkownika).</span><span class="sxs-lookup"><span data-stu-id="b75b1-201">If there is a difference in time between the on board RTC and the server time (which the SNTP Client local time should be set to), the RTC should be synched to the SNTP Client time (we do not demonstrate that in this User Guide).</span></span>

<span data-ttu-id="b75b1-202">Ponieważ aktualizacje serwera SNTP nie powinny występować częściej niż raz na godzinę, nie jest przydatne sondowanie klienta SNTP pod kątem aktualizacji serwera lub stanu serwera częściej niż to możliwe.</span><span class="sxs-lookup"><span data-stu-id="b75b1-202">Since SNTP server updates should not occur more often than once per hour, it is not useful to poll the SNTP Client for server updates or server status more often than that.</span></span> <span data-ttu-id="b75b1-203">Jednak klient SNTP powinien zaktualizować swój zegar lokalny wystarczająco często, aby nie był większy niż maksymalny parametr dostosowania czasu NX_SNTP_CLIENT_MAX_TIME_LAPSE.</span><span class="sxs-lookup"><span data-stu-id="b75b1-203">However, the SNTP Client should update its local clock often enough not to fall further than the maximum time adjustment parameter NX_SNTP_CLIENT_MAX_TIME_LAPSE.</span></span>

<span data-ttu-id="b75b1-204">Alternatywnie można ustawić maksymalny NX_SNTP_CLIENT_MAX_TIME_LAPSE korekty na wartość większą niż aktualizacja sondowania emisji pojedynczej (lub przewidywane interwały emisji).</span><span class="sxs-lookup"><span data-stu-id="b75b1-204">Alternatively, the maximum adjustment NX_SNTP_CLIENT_MAX_TIME_LAPSE can be set to greater than the unicast polling update (or anticipated broadcast intervals).</span></span> <span data-ttu-id="b75b1-205">Ten ostatni eliminuje potrzebę niezależnego zegara w czasie rzeczywistym.</span><span class="sxs-lookup"><span data-stu-id="b75b1-205">The latter eliminates the need for an independent real time clock.</span></span> <span data-ttu-id="b75b1-206">Jednak zamiarem protokołu SNTP jest uniknięcie całkowitej zależności od lokalnych aktualizacji RTC lub czasu w sieci.</span><span class="sxs-lookup"><span data-stu-id="b75b1-206">However, the intention of SNTP protocol is to avoid total reliance on either local RTC or network time updates.</span></span> <span data-ttu-id="b75b1-207">Ponadto aktualizacje serwera SNTP są przeznaczone do zapobiegania dryfowi w lokalnym zegarze czasu.</span><span class="sxs-lookup"><span data-stu-id="b75b1-207">Further, the SNTP Server updates are intended to prevent drift in the local time clock.</span></span>

## <a name="multiple-network-interfaces"></a><span data-ttu-id="b75b1-208">Wiele interfejsów sieciowych</span><span class="sxs-lookup"><span data-stu-id="b75b1-208">Multiple Network Interfaces</span></span>

<span data-ttu-id="b75b1-209">Klienta SNTP NetX Duo można skonfigurować do uruchamiania w sieciach pomocniczych, o ile te sieci są zarejestrowane w wystąpieniu IP.</span><span class="sxs-lookup"><span data-stu-id="b75b1-209">NetX Duo SNTP Client can be configured to run on secondary networks as long as those networks are registered with the IP instance.</span></span> <span data-ttu-id="b75b1-210">Więcej informacji na temat rejestrowania sieci dodatkowych można znaleźć w podręczniku użytkownika NetX Duo lub NetX.</span><span class="sxs-lookup"><span data-stu-id="b75b1-210">See the NetX Duo or NetX User Guide for more information on how to register secondary networks.</span></span>

<span data-ttu-id="b75b1-211">W wywołaniu *nx_sntp_client_create* Ustaw trzecią wartość wejściową, iface_index na indeks sieci dla klienta SNTP, na który mają zostać odebrane aktualizacje.</span><span class="sxs-lookup"><span data-stu-id="b75b1-211">In the *nx_sntp_client_create* call, set the third input, iface_index, to the index of the network for the SNTP Client to receive time updates on.</span></span> <span data-ttu-id="b75b1-212">Interfejs podstawowy ma zawsze indeks 0.</span><span class="sxs-lookup"><span data-stu-id="b75b1-212">The primary interface is always at index 0.</span></span> <span data-ttu-id="b75b1-213">Klient SNTP NetX Duo nie może obsługiwać aktualizacji czasu jednocześnie w wielu interfejsach sieciowych.</span><span class="sxs-lookup"><span data-stu-id="b75b1-213">NetX Duo SNTP Client cannot support time updates simultaneously on multiple network interface.</span></span>

## <a name="sntp-and-ntp-rfcs"></a><span data-ttu-id="b75b1-214">Specyfikacje RFC protokołu SNTP i NTP</span><span class="sxs-lookup"><span data-stu-id="b75b1-214">SNTP and NTP RFCs</span></span>

<span data-ttu-id="b75b1-215">Klient SNTP NetX Duo jest zgodny z RFC4330em "Simple Network Time Protocol (SNTP) w wersji 4 dla protokołów IPv4, IPv6 i OSI" oraz pokrewnych specyfikacji RFC.</span><span class="sxs-lookup"><span data-stu-id="b75b1-215">NetX Duo SNTP client is compliant with RFC4330 “Simple Network Time Protocol (SNTP) Version 4 for IPv4, IPv6 and OSI” and related RFCs.</span></span>